<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>TRUST TAP ‚Ä¢ ADMIN PANEL</title>
    <style>
        /* –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è –ø—ñ–¥ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π –¥–∞—à–±–æ—Ä–¥ */
        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            background: #0f172a; 
            color: #f8fafc; 
            padding: 20px; 
            margin: 0;
        }
        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px;
            background: #1e293b;
            padding: 15px 25px;
            border-radius: 12px;
            border: 1px solid #334155;
        }
        h2 { margin: 0; color: #3b82f6; letter-spacing: 1px; }
        .status-badge { 
            padding: 6px 12px; 
            background: #10b981; 
            border-radius: 20px; 
            font-size: 13px; 
            font-weight: 600;
            transition: all 0.3s;
        }
        table { 
            width: 100%; 
            border-collapse: separate; 
            border-spacing: 0;
            background: #1e293b; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3); 
            border-radius: 12px; 
            overflow: hidden;
            border: 1px solid #334155;
        }
        th { 
            background-color: #3b82f6; 
            color: white; 
            padding: 15px; 
            text-align: left; 
            font-size: 14px;
            text-transform: uppercase;
        }
        td { 
            padding: 15px; 
            border-bottom: 1px solid #334155; 
            font-size: 14px;
        }
        tr:last-child td { border-bottom: none; }
        tr:hover { background-color: #2d3748; }
        
        .money { color: #4ade80; font-weight: 700; font-family: monospace; font-size: 16px; }
        .energy { color: #facc15; font-weight: 600; }
        .online { color: #4ade80; font-weight: bold; animation: pulse 2s infinite; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .loading-row { text-align: center; padding: 40px; color: #94a3b8; }
    </style>
</head>
<body>

    <div class="header">
        <h2>üë• TRUST TAP ADMIN</h2>
        <div class="status-badge" id="updateStatus">–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è...</div>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>Telegram ID</th>
                <th>–ù—ñ–∫–Ω–µ–π–º</th>
                <th>–ë–∞–ª–∞–Ω—Å (USDT)</th>
                <th>–ï–Ω–µ—Ä–≥—ñ—è</th>
                <th>–†–µ—Ñ–µ—Ä–∞–ª–∏</th>
                <th>–ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</th>
            </tr>
        </thead>
        <tbody id="usersTable">
            <tr><td colspan="6" class="loading-row">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ —Å–µ—Ä–≤–µ—Ä–∞ Render...</td></tr>
        </tbody>
    </table>

    <script>
        // –¢–≤–æ—è –æ—Ñ—ñ—Ü—ñ–π–Ω–∞ –∞–¥—Ä–µ—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞
        const API_URL = 'https://click-9pdn.onrender.com/api/admin/users'; 

        function fetchUsers() {
            const statusBadge = document.getElementById('updateStatus');
            statusBadge.textContent = '–û–Ω–æ–≤–ª—é—é...';
            statusBadge.style.background = '#3b82f6';
            
            fetch(API_URL)
                .then(res => {
                    if (!res.ok) throw new Error('–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                    return res.json();
                })
                .then(users => {
                    const tbody = document.getElementById('usersTable');
                    tbody.innerHTML = ''; 
                    
                    if (users.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" class="loading-row">–ì—Ä–∞–≤—Ü—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î. –ó–∞–π–¥–∏ –≤ –≥—Ä—É, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø–µ—Ä—à–∏–π –∑–∞–ø–∏—Å!</td></tr>';
                    }

                    users.forEach(u => {
                        const lastDate = new Date(u.lastSync);
                        const diffSec = Math.floor((new Date() - lastDate) / 1000);
                        
                        // –°—Ç–∞—Ç—É—Å "–û–Ω–ª–∞–π–Ω", —è–∫—â–æ –æ—Å—Ç–∞–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –±—É–ª–∞ –º–µ–Ω—à–µ 40 —Å–µ–∫—É–Ω–¥ —Ç–æ–º—É
                        const activityHTML = diffSec < 40 
                            ? '<span class="online">üü¢ –û–Ω–ª–∞–π–Ω</span>' 
                            : lastDate.toLocaleString('uk-UA');

                        tbody.innerHTML += `
                            <tr>
                                <td><code>${u.telegramId}</code></td>
                                <td>${u.username ? '@' + u.username : '<i>–ü—Ä–∏—Ö–æ–≤–∞–Ω–æ</i>'}</td>
                                <td class="money">${u.balance.toFixed(6)}</td>
                                <td class="energy">‚ö° ${Math.floor(u.energy)}</td>
                                <td>${u.referrals || 0} üë•</td>
                                <td>${activityHTML}</td>
                            </tr>
                        `;
                    });
                    
                    statusBadge.textContent = '–û–Ω–æ–≤–ª–µ–Ω–æ —â–æ–π–Ω–æ';
                    statusBadge.style.background = '#10b981';
                })
                .catch(err => {
                    console.error(err);
                    statusBadge.textContent = '‚ùå –°–µ—Ä–≤–µ—Ä —Å–ø–∏—Ç—å... —á–µ–∫–∞–π—Ç–µ';
                    statusBadge.style.background = '#ef4444';
                });
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        fetchUsers();

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥
        setInterval(fetchUsers, 10000);
    </script>
</body>
</html>
