<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TRUST TAP ‚Ä¢ CRYPTO WALLET GAME</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none; 
        }

        body {
            background: #030712;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100dvh;
            overflow-x: hidden;
            padding: 0; 
        }

        .game-container {
            max-width: 480px;
            width: 100%;
            background: linear-gradient(145deg, #0f1a2f, #030a18);
            border-radius: 0; 
            padding: calc(1.5rem + env(safe-area-inset-top, 20px)) 1rem 3rem 1rem; 
            min-height: 100dvh;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.9), 0 0 0 1px #1e3a5f inset;
            color: #ffffff;
            position: relative;
            overflow: hidden;
        }

        @media (min-width: 480px) {
            body { padding: 1rem; align-items: center; }
            .game-container { border-radius: 3rem 3rem 2rem 2rem; min-height: 90vh; padding: 2rem 1.5rem 2rem 1.5rem; }
        }

        .handwritten-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; opacity: 0.3; }
        .handwritten-bg span { 
            position: absolute; font-size: 1.2rem; font-weight: 300; color: #3b82f6; 
            font-family: 'Caveat', cursive; transform: rotate(calc(var(--r) * 1deg)); 
            animation: floatT 8s infinite alternate; animation-delay: calc(var(--d) * -1s); 
            text-shadow: 0 0 5px #3b82f6; opacity: 0.6; pointer-events: none;
            will-change: transform, opacity;
        }
        @keyframes floatT { 0% { transform: translateY(0) rotate(calc(var(--r) * 1deg)) scale(1); opacity: 0.4; } 50% { transform: translateY(-15px) rotate(calc(var(--r) * 1deg)) scale(1.1); opacity: 0.8; } 100% { transform: translateY(15px) rotate(calc(var(--r) * 1deg)) scale(0.9); opacity: 0.5; } }

        .game-container::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 50%, transparent 30%, rgba(3, 7, 18, 0.7) 90%); pointer-events: none; z-index: 0; }

        .top-bar, .top-ref-bar, .feature-card, .tasks-section, .upgrade-section {
            background: rgba(20, 40, 70, 0.55); 
            border: 1px solid rgba(59, 130, 246, 0.2);
            position: relative;
            z-index: 2;
        }

        .top-bar { 
            display: flex; justify-content: center; align-items: center; 
            padding: 0.8rem 1.2rem; 
            border-radius: 2.5rem; 
            margin-bottom: 2rem; 
            box-shadow: 0 5px 0 rgba(10, 26, 47, 0.6), 0 8px 15px rgba(0, 0, 0, 0.3); 
            width: max-content; min-width: 60%; 
            margin-left: auto; margin-right: auto; 
        }
        
        .balance-box { 
            display: flex; 
            align-items: center; 
            gap: 2px; 
        }
        .usdt-icon { 
            width: 26px; 
            height: 26px; 
            object-fit: contain; 
            display: block;
        }
        .usdt-text { 
            font-size: 1rem; 
            font-weight: 600; 
            color: #ffffff; 
            text-shadow: 0 0 8px #3b82f6; 
            margin-right: 6px; 
        }
        .balance-amount { 
            font-size: 0.9rem; 
            font-weight: 600; 
            color: #ffffff; 
            text-shadow: 0 0 8px #3b82f6; 
            white-space: nowrap;
        }
        .balance-amount::after { content: ' USDT'; color: #aaccff; font-size: 0.7rem; margin-left: 2px; }

        .energy-panel { 
            background: rgba(10, 20, 35, 0.6); 
            border-radius: 2rem; 
            padding: 0.4rem 0.8rem; 
            margin: 0 auto 3rem auto; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3), inset 0 1px 2px rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(5px);
            width: 250px; 
            position: relative;
            z-index: 2;
        }
        
        .energy-left { display: flex; align-items: center; gap: 0.3rem; }
        .bolt { font-size: 0.8rem; color: #f5c45e; filter: drop-shadow(0 0 3px rgba(245, 196, 94, 0.5)); } 
        .energy-count { font-weight: 700; font-size: 0.8rem; color: #ffffff; text-shadow: 0 0 5px rgba(255,255,255,0.3); min-width: 35px; }
        
        .energy-bar-bg { flex-grow: 1; height: 6px; background: rgba(0, 0, 0, 0.6); border-radius: 10px; overflow: hidden; margin: 0 8px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.8); }
        .energy-bar-fill { height: 100%; width: 80%; background: linear-gradient(90deg, #3b82f6, #aaccff, #ffffff); border-radius: 10px; box-shadow: 0 0 8px #aaccff; transition: width 0.1s cubic-bezier(0.4, 0, 0.2, 1); }
        .regen-tip { color: rgba(170, 204, 255, 0.8); font-size: 0.65rem; white-space: nowrap; font-weight: 500; }

        .tap-zone { display: flex; justify-content: center; margin: 0 0 1.5rem 0; cursor: pointer; position: relative; z-index: 5; touch-action: none; }

        .big-coin { 
            width: 250px; height: 250px; 
            background: radial-gradient(circle at 30% 30%, #2b6ed7, #0a2a6a, #031030); 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; position: relative; 
            transition: transform 0.05s ease-out; border: 2px solid rgba(255, 255, 255, 0.4); 
            box-shadow: 0 20px 30px -10px rgba(0, 0, 0, 0.8), 0 0 0 2px rgba(59, 130, 246, 0.3) inset, 0 0 40px rgba(59, 130, 246, 0.5); 
            animation: modernFloat 5s infinite ease-in-out; 
        }
        
        .big-coin::after { content: ''; position: absolute; inset: -15px; border-radius: 50%; background: radial-gradient(circle at 50% 50%, rgba(59, 130, 246, 0.6), transparent 70%); z-index: -1; animation: pulseGlow 2.5s infinite alternate; pointer-events: none; }
        @keyframes pulseGlow { 0% { opacity: 0.5; transform: scale(0.95); } 100% { opacity: 1; transform: scale(1.05); } }
        .big-coin::before { content: ''; position: absolute; inset: 10px; border-radius: 50%; background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.1) 60%, transparent 80%); border: 1px solid rgba(255, 255, 255, 0.4); z-index: 1; pointer-events: none; }
        @keyframes modernFloat { 0% { transform: translateY(0px); } 50% { transform: translateY(-8px); } 100% { transform: translateY(0px); } }
        
        .big-coin.pressed { transform: scale(0.92) !important; box-shadow: 0 15px 20px -5px rgba(0, 0, 0, 0.9), 0 0 0 3px rgba(59, 130, 246, 0.8) inset, 0 0 70px #3b82f6, 0 0 120px rgba(59, 130, 246, 0.9) !important; }
        .trust-logo { position: relative; z-index: 10; width: 140px; height: 140px; display: flex; align-items: center; justify-content: center; pointer-events: none; }
        .letter-t { font-size: 8.5rem; font-weight: 900; color: #ffffff; text-shadow: 0 0 30px rgba(255, 255, 255, 0.9), 0 0 60px #3b82f6; line-height: 1; animation: letterSuperPulse 2.5s infinite alternate; letter-spacing: -5px; }
        @keyframes letterSuperPulse { 0% { transform: scale(1); } 100% { transform: scale(1.03); } }

        .tap-value { 
            color: rgba(170, 204, 255, 0.5); 
            font-size: 0.75rem; 
            text-align: center; 
            margin: 0 auto 2.5rem auto; 
            font-weight: 400;
            position: relative;
            z-index: 10; 
            background: rgba(10, 20, 35, 0.15); 
            padding: 0.3rem 0.8rem;
            border-radius: 1rem;
            border: 1px solid rgba(59, 130, 246, 0.05);
            backdrop-filter: blur(2px);
            width: max-content;
            letter-spacing: 0.5px;
        }

        .floating-value { 
            position: fixed; 
            font-weight: 600; 
            font-size: 1rem; 
            color: #aaccff; 
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.25);
            border-radius: 1.5rem;
            padding: 0.2rem 0.7rem;
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.1), inset 0 0 8px rgba(59, 130, 246, 0.2);
            backdrop-filter: blur(2px);
            pointer-events: none; 
            animation: floatUpAnim 0.8s ease-out forwards; 
            z-index: 9999; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .floating-value::after { content: ' $'; font-size: 0.8rem; color: #aaccff; margin-left: 2px; }
        @keyframes floatUpAnim { 
            0% { opacity: 1; transform: translate(-50%, -50%) scale(0.8); } 
            50% { opacity: 0.9; transform: translate(-50%, calc(-50% - 40px)) scale(1.05); } 
            100% { opacity: 0; transform: translate(-50%, calc(-50% - 80px)) scale(1.1); } 
        }

        .top-ref-bar { border-radius: 1.12rem; padding: 0.7rem 0.8rem; margin: 1rem 0; box-shadow: 0 3px 0 rgba(10, 26, 47, 0.6); display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
        .top-ref-bar:active { transform: translateY(2px); box-shadow: 0 1px 0 rgba(10, 26, 47, 0.6); }
        .top-ref-left { display: flex; align-items: center; gap: 0.6rem; }
        .top-ref-left span { font-size: 0.95rem; color: #ffffff; font-weight: 500; }
        
        .top-ref-right { 
            display: flex;
            align-items: center;
            gap: 8px; 
            background: rgba(59, 130, 246, 0.05); 
            color: #aaccff; 
            font-weight: 600; 
            font-size: 1rem; 
            padding: 0.6rem 1.1rem; 
            border-radius: 2rem; 
            border: 1px solid rgba(59, 130, 246, 0.25); 
            box-shadow: 0 0 5px rgba(59, 130, 246, 0.1), inset 0 0 8px rgba(59, 130, 246, 0.3), inset 0 1px 2px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(2px);
        }
        .top-ref-right svg { width: 16px; height: 16px; } 

        .feature-grid { display: flex; gap: 0.6rem; margin: 0.8rem 0 1.2rem; justify-content: center; }
        .feature-card { border-radius: 1.12rem; padding: 0.7rem 0.8rem; flex: 1; display: flex; align-items: center; justify-content: space-between; gap: 8px; box-shadow: 0 3px 0 rgba(10, 26, 47, 0.6); }
        .feature-card:active { transform: translateY(2px); box-shadow: 0 1px 0 rgba(10, 26, 47, 0.6); }
        .card-left { display: flex; align-items: center; gap: 0.6rem; min-width: 0; }
        .card-label { font-size: 0.85rem; color: #ffffff; font-weight: 500; } 
        .card-value { font-weight: 600; font-size: 0.85rem; color: #ffffff; flex-shrink: 0; }

        .tasks-section, .upgrade-section { border-radius: 1.12rem; padding: 1rem 0.4rem; margin: 1rem 0; box-shadow: 0 3px 0 rgba(10, 26, 47, 0.6); }
        .section-header { display: flex; align-items: center; gap: 0.6rem; margin-bottom: 1rem; padding-left: 0.4rem; }
        .section-title { font-size: 1rem; font-weight: 700; color: #ffffff; text-shadow: 0 0 10px #3b82f6; }

        .upgrade-item, .task-item { background: rgba(10, 20, 35, 0.55); border-radius: 0.9rem; padding: 0.6rem 0.4rem; margin-bottom: 0.6rem; display: flex; align-items: center; justify-content: space-between; gap: 0.4rem; border: 1px solid rgba(59, 130, 246, 0.2); box-shadow: 0 2px 0 rgba(10, 26, 47, 0.5); cursor: pointer; }
        .upgrade-item:active, .task-item:active { transform: translateY(2px); box-shadow: 0 1px 0 rgba(10, 26, 47, 0.5); }

        .card-icon, .item-icon, .section-icon { width: 24px; height: 24px; min-width: 24px; min-height: 24px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .card-icon svg, .item-icon svg, .section-icon svg { width: 100%; height: 100%; display: block; filter: brightness(0) invert(1); }

        .item-left { display: flex; align-items: center; gap: 0.6rem; flex: 1; min-width: 0; }
        .item-info { display: flex; flex-direction: column; min-width: 0; width: 100%; }
        .item-name { font-weight: 600; font-size: 0.8rem; color: #ffffff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 100%; }
        .item-level { font-size: 0.65rem; color: #aaccff; margin-top: 0.1rem; }
        
        .item-right { display: flex; align-items: center; gap: 0.5rem; flex-shrink: 0; }
        
        .item-value { font-weight: 500; font-size: 0.75rem; color: rgba(170, 204, 255, 0.7); white-space: nowrap; }
        .task-reward { font-size: 0.7rem; font-weight: 500; color: rgba(170, 204, 255, 0.7); white-space: nowrap; }

        .item-button { 
            background: rgba(59, 130, 246, 0.05);
            color: #aaccff;
            font-weight: 500;
            font-size: 0.7rem; 
            padding: 0.35rem 0.7rem; 
            border-radius: 1.5rem; 
            border: 1px solid rgba(59, 130, 246, 0.25);
            box-shadow: 
                0 0 5px rgba(59, 130, 246, 0.1),
                inset 0 0 8px rgba(59, 130, 246, 0.3),
                inset 0 1px 2px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(2px); 
            cursor: pointer; 
            text-transform: uppercase; 
            white-space: nowrap; 
            flex-shrink: 0; 
            transition: all 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        
        .item-button:active { 
            transform: scale(0.92);
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.4);
            box-shadow: 
                0 0 8px rgba(59, 130, 246, 0.2),
                inset 0 0 12px rgba(59, 130, 246, 0.4),
                inset 0 1px 2px rgba(255, 255, 255, 0.15);
            color: #ffffff;
        }

        .task-special { background: linear-gradient(145deg, #2a4a8a, #1a3a6a); border: 1px solid #3b82f6; }
        .notice { text-align: center; font-size: 0.65rem; color: #aaccff; margin-top: 1rem; border-top: 1px dashed rgba(59, 130, 246, 0.3); padding-top: 0.8rem; }

        .game-container, .top-bar, .feature-card, .upgrade-item, .task-item { transform: translateZ(0); backface-visibility: hidden; }

        /* Admin Panel Styles */
        .admin-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(145deg, #2b6ed7, #0a2a6a);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            z-index: 10000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            transition: all 0.2s;
        }

        .admin-btn:active {
            transform: scale(0.9);
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .admin-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(3, 7, 18, 0.95);
            backdrop-filter: blur(10px);
            z-index: 20000;
            overflow-y: auto;
            display: none;
            color: white;
            padding: 20px;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
        }

        .admin-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3b82f6;
        }

        .admin-close {
            font-size: 2rem;
            cursor: pointer;
            padding: 0 10px;
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 10px 20px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .admin-tab.active {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
        }

        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(20, 40, 70, 0.55);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #3b82f6;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(170, 204, 255, 0.8);
            margin-top: 5px;
        }

        .users-list {
            max-height: 500px;
            overflow-y: auto;
            background: rgba(10, 20, 35, 0.55);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 10px;
            padding: 10px;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
            cursor: pointer;
        }

        .user-item:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .user-info {
            flex: 1;
        }

        .user-id {
            font-weight: bold;
            color: #3b82f6;
        }

        .user-details {
            font-size: 0.8rem;
            color: rgba(170, 204, 255, 0.8);
        }

        .user-balance {
            font-weight: bold;
            color: #fff;
        }

        .tasks-stats {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .task-stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(10, 20, 35, 0.55);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 10px;
        }

        .task-name {
            font-weight: 500;
        }

        .task-completed {
            color: #4caf50;
        }

        .referral-tree {
            background: rgba(10, 20, 35, 0.55);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 10px;
            padding: 10px;
            min-height: 200px;
        }

        .tree-node {
            margin-left: 20px;
            padding-left: 10px;
            border-left: 1px dashed rgba(59, 130, 246, 0.3);
            margin-top: 5px;
        }

        .tree-node-content {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px;
        }

        .tree-node:hover {
            background: rgba(59, 130, 246, 0.1);
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="handwritten-bg" id="handwrittenBg"></div>

        <div class="top-bar">
            <div class="balance-box">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233b82f6'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z'/%3E%3C/svg%3E" class="usdt-icon" alt="USDT">
                <span class="usdt-text">USDT</span>
                <span class="balance-amount" id="balanceDisplay">10.500000</span>
            </div>
        </div>

        <div class="energy-panel">
            <div class="energy-left">
                <span class="bolt">‚ö°</span>
                <span class="energy-count" id="energyDisplay">1000</span>
            </div>
            <div class="energy-bar-bg">
                <div class="energy-bar-fill" id="energyBarFill" style="width: 100%;"></div>
            </div>
            <span class="regen-tip" id="regenTip">+1/—Å–µ–∫</span>
        </div>

        <div class="tap-zone" id="tapButton">
            <div class="big-coin">
                <div class="trust-logo">
                    <span class="letter-t">T</span>
                </div>
            </div>
        </div>

        <div class="tap-value" id="tapValueDisplay">0.000200 USDT –∑–∞ —Ç–∞–ø</div>

        <div class="top-ref-bar" id="topRefBar">
            <div class="top-ref-left">
                <span class="item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 5H18L21 9L12 20L3 9L6 5Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M3 9H21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 20L8 9" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 20L16 9" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </span>
                <span>–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞</span>
            </div>
            <div class="top-ref-right">
                <span>+500</span>
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" fill="white"/>
                </svg>
                <span>+10%</span>
            </div>
        </div>

        <div class="feature-grid">
            <div class="feature-card" id="rankCard">
                <div class="card-left">
                    <span class="card-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L15 8L22 9L17 14L18 21L12 17.5L6 21L7 14L2 9L9 8L12 2Z" fill="white"/>
                        </svg>
                    </span>
                    <span class="card-label">–†–∞–Ω–≥</span>
                </div>
                <span class="card-value">–ë—Ä–æ–Ω–∑–∞</span>
            </div>
            <div class="feature-card" id="referralsCard">
                <div class="card-left">
                    <span class="card-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16 11C17.66 11 19 9.66 19 8C19 6.34 17.66 5 16 5C14.34 5 13 6.34 13 8C13 9.66 14.34 11 16 11ZM8 11C9.66 11 11 9.66 11 8C11 6.34 9.66 5 8 5C6.34 5 5 6.34 5 8C5 9.66 6.34 11 8 11ZM8 13C5.79 13 2 14.79 2 17V19H22V17C22 14.79 18.21 13 16 13C14.55 13 12.81 13.55 12 14.38C11.19 13.55 9.45 13 8 13Z" fill="white"/>
                        </svg>
                    </span>
                    <span class="card-label">–†–µ—Ñ–µ—Ä–∞–ª—ã</span>
                </div>
                <span class="card-value" id="refCount">0</span>
            </div>
        </div>

        <div class="upgrade-section">
            <div class="section-header">
                <span class="section-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" stroke="white" stroke-width="2"/>
                        <path d="M12 6V12L16 14" stroke="white" stroke-width="2"/>
                    </svg>
                </span>
                <span class="section-title">–£–ª—É—á—à–µ–Ω–∏—è</span>
            </div>
            
            <div class="upgrade-item" id="upgradeDamage">
                <div class="item-left">
                    <span class="item-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="white" stroke-width="2"/>
                            <path d="M12 6V12L16 14" stroke="white" stroke-width="2"/>
                        </svg>
                    </span>
                    <div class="item-info">
                        <span class="item-name">–£—Ä–æ–Ω –∑–∞ –∫–ª–∏–∫</span>
                        <span class="item-level" id="damageLevel">—É—Ä. 1</span>
                    </div>
                </div>
                <div class="item-right">
                    <span class="item-value" id="damageValue">1.0x</span>
                    <button class="item-button upgrade-btn" data-type="damage">–£–ª—É—á—à–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="upgrade-item" id="upgradeCapacity">
                <div class="item-left">
                    <span class="item-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="6" y="2" width="12" height="20" rx="2" stroke="white" stroke-width="2"/>
                            <rect x="10" y="6" width="4" height="4" fill="white"/>
                        </svg>
                    </span>
                    <div class="item-info">
                        <span class="item-name">–Å–º–∫–æ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏–∏</span>
                        <span class="item-level" id="capacityLevel">—É—Ä. 1</span>
                    </div>
                </div>
                <div class="item-right">
                    <span class="item-value" id="capacityValue">1000</span>
                    <button class="item-button upgrade-btn" data-type="capacity">–£–ª—É—á—à–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="upgrade-item" id="upgradeRecovery">
                <div class="item-left">
                    <span class="item-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" fill="white"/>
                        </svg>
                    </span>
                    <div class="item-info">
                        <span class="item-name">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
                        <span class="item-level" id="recoveryLevel">—É—Ä. 1</span>
                    </div>
                </div>
                <div class="item-right">
                    <span class="item-value" id="recoveryValue">1/—Å–µ–∫</span>
                    <button class="item-button upgrade-btn" data-type="recovery">–£–ª—É—á—à–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <div class="tasks-section">
            <div class="section-header">
                <span class="section-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="3" y="4" width="18" height="16" rx="2" stroke="white" stroke-width="2"/>
                        <path d="M8 10L11 13L16 7" stroke="white" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </span>
                <span class="section-title">–ó–∞–¥–∞–Ω–∏—è</span>
            </div>
            
            <div class="task-item" id="taskSubscribe">
                <div class="item-left">
                    <span class="item-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M22 2L11 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </span>
                    <span class="item-name">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª</span>
                </div>
                <div class="item-right">
                    <span class="task-reward">+0.80 USDT</span>
                    <button class="item-button task-btn" data-task="subscribe">–°—Ç–∞—Ä—Ç</button>
                </div>
            </div>
            
            <div class="task-item" id="taskAd">
                <div class="item-left">
                    <span class="item-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="2" y="6" width="20" height="12" rx="2" stroke="white" stroke-width="2"/>
                            <circle cx="17" cy="12" r="2" fill="white"/>
                        </svg>
                    </span>
                    <span class="item-name">–°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º—É</span>
                </div>
                <div class="item-right">
                    <span class="task-reward">+0.20 USDT</span>
                    <button class="item-button task-btn" data-task="ad">–°—Ç–∞—Ä—Ç</button>
                </div>
            </div>
            
            <div class="task-item" id="taskWallet">
                <div class="item-left">
                    <span class="item-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="6" width="18" height="12" rx="2" stroke="white" stroke-width="2"/>
                            <path d="M16 12H18" stroke="white" stroke-width="2" stroke-linecap="round"/>
                            <circle cx="17" cy="12" r="1" fill="white"/>
                        </svg>
                    </span>
                    <span class="item-name">–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫–æ—à–µ–ª—ë–∫</span>
                </div>
                <div class="item-right">
                    <span class="task-reward">+22.50 USDT</span>
                    <button class="item-button task-btn" data-task="wallet">–°—Ç–∞—Ä—Ç</button>
                </div>
            </div>
            
            <div class="task-item task-special" id="taskBlum">
                <div class="item-left">
                    <span class="item-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="8" stroke="white" stroke-width="2"/>
                            <circle cx="12" cy="8" r="1" fill="white"/>
                            <circle cx="16" cy="12" r="1" fill="white"/>
                            <circle cx="8" cy="12" r="1" fill="white"/>
                            <path d="M8 16L12 18L16 16" stroke="white" stroke-width="2"/>
                        </svg>
                    </span>
                    <span class="item-name">–ö–≤–µ—Å—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</span>
                </div>
                <div class="item-right">
                    <button class="item-button task-btn" data-task="blum" disabled style="opacity: 0.5;">–°–∫–æ—Ä–æ</button>
                </div>
            </div>
        </div>

        <div class="notice">
            ‚ö° Trust Wallet ¬∑ Tap to earn
        </div>
    </div>

    <div class="admin-btn" id="adminBtn">A</div>

    <div class="admin-panel" id="adminPanel">
        <div class="admin-header">
            <span class="admin-title">üîê –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</span>
            <span class="admin-close" id="adminClose">√ó</span>
        </div>

        <div class="admin-tabs">
            <div class="admin-tab active" data-tab="stats">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <div class="admin-tab" data-tab="users">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
            <div class="admin-tab" data-tab="tasks">üìù –ó–∞–¥–∞–Ω–∏—è</div>
            <div class="admin-tab" data-tab="referrals">üîó –†–µ—Ñ–µ—Ä–∞–ª—ã</div>
        </div>

        <div class="admin-tab-content active" id="tab-stats">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeToday">0</div>
                    <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalBalance">0</div>
                    <div class="stat-label">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalTaps">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Ç–∞–ø–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalReferrals">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgLevel">1.0</div>
                    <div class="stat-label">–°—Ä. —É—Ä–æ–≤–µ–Ω—å</div>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                <div class="users-list" id="recentActivity"></div>
            </div>
        </div>

        <div class="admin-tab-content" id="tab-users">
            <div style="margin-bottom: 10px;">
                <input type="text" id="userSearch" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ ID, –∏–º–µ–Ω–∏ –∏–ª–∏ username..." style="width: 100%; padding: 10px; background: rgba(10,20,35,0.8); border: 1px solid rgba(59,130,246,0.3); border-radius: 10px; color: white;">
            </div>
            <div class="users-list" id="usersList"></div>
        </div>

        <div class="admin-tab-content" id="tab-tasks">
            <div class="tasks-stats" id="tasksStats">
                <div class="task-stat-item">
                    <span class="task-name">üì∫ –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª</span>
                    <span class="task-completed" id="taskSubscribeCount">0/0</span>
                </div>
                <div class="task-stat-item">
                    <span class="task-name">üìπ –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∫–ª–∞–º—ã</span>
                    <span class="task-completed" id="taskAdCount">0/0</span>
                </div>
                <div class="task-stat-item">
                    <span class="task-name">üí≥ –ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ—à–µ–ª—å–∫–∞</span>
                    <span class="task-completed" id="taskWalletCount">0/0</span>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
                <div class="stats-grid" style="grid-template-columns: 1fr;">
                    <div class="stat-card">
                        <div class="stat-value" id="totalRewards">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –≤—ã–¥–∞–Ω–æ –Ω–∞–≥—Ä–∞–¥</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="admin-tab-content" id="tab-referrals">
            <div style="margin-bottom: 10px;">
                <select id="referralUserSelect" style="width: 100%; padding: 10px; background: rgba(10,20,35,0.8); border: 1px solid rgba(59,130,246,0.3); border-radius: 10px; color: white;">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>
                </select>
            </div>
            <div class="referral-tree" id="referralTree">
                <div style="text-align: center; color: rgba(170,204,255,0.5); padding: 20px;">
                    –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // Telegram WebApp initialization
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready();
                tg.expand();
                
                try {
                    if (tg.requestFullscreen) tg.requestFullscreen();
                } catch(e) {}
                
                tg.disableVerticalSwipes();
                
                requestAnimationFrame(() => {
                    window.scrollTo(0, 1);
                    setTimeout(() => window.scrollTo(0, 0), 50);
                });
            }

            // Get user ID from Telegram or generate one
            let userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            let userName = 'User';
            let userUsername = ''; // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è username
            
            if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe) {
                const user = window.Telegram.WebApp.initDataUnsafe.user;
                if (user) {
                    userId = user.id.toString();
                    userName = user.first_name || 'User';
                    if (user.last_name) userName += ' ' + user.last_name;
                    userUsername = user.username || ''; // –°–æ—Ö—Ä–∞–Ω—è–µ–º username –∏–∑ Telegram
                }
            }

            // Get referral from URL if exists
            const urlParams = new URLSearchParams(window.location.search);
            const referrerId = urlParams.get('ref');

            // Economy constants
            const ECONOMY = {
                usdt: { decimals: 6, baseTapValue: 0.0002 },
                energy: { baseCapacity: 1000, baseRecovery: 1, tapCost: 1 },
                upgrades: {
                    damage: [1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0, 6.0],
                    capacity: [1.0, 1.3, 1.6, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0],
                    recovery: [1.0, 1.3, 1.6, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0]
                },
                upgradePrices: {
                    damage: [2.5, 5.0, 10.0, 20.0, 40.0, 80.0, 160.0, 320.0, 640.0, 1280.0],
                    capacity: [3.0, 6.0, 12.0, 24.0, 48.0, 96.0, 192.0, 384.0, 768.0, 1536.0],
                    recovery: [1.5, 3.0, 6.0, 12.0, 24.0, 48.0, 96.0, 192.0, 384.0, 768.0]
                },
                tasks: { 
                    subscription: 0.80, 
                    adReward: 0.20, 
                    walletReward: 22.50, 
                    referralBonusEnergy: 500 
                }
            };

            // Player state
            let player = {
                userId: userId,
                userName: userName,
                userUsername: userUsername, // –î–æ–±–∞–≤–ª—è–µ–º username –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
                balance: 10.500000,
                damageLevel: 1,
                capacityLevel: 1,
                recoveryLevel: 1,
                energy: ECONOMY.energy.baseCapacity,
                referrals: 0,
                referrer: referrerId || null,
                tasks: {
                    subscribe: false,
                    ad: false,
                    wallet: false
                },
                totalTaps: 0,
                lastActive: Date.now(),
                createdAt: Date.now(),
                referralProcessed: false
            };

            // Helper functions
            function formatUSDT(value) { 
                return parseFloat(value).toFixed(6); 
            }

            function getCurrentTapValue() { 
                return (ECONOMY.usdt.baseTapValue * ECONOMY.upgrades.damage[player.damageLevel - 1]).toFixed(6); 
            }

            function getCurrentCapacity() { 
                return Math.floor(ECONOMY.energy.baseCapacity * ECONOMY.upgrades.capacity[player.capacityLevel - 1]); 
            }

            function getCurrentRecovery() { 
                return ECONOMY.energy.baseRecovery * ECONOMY.upgrades.recovery[player.recoveryLevel - 1]; 
            }

            // ============= –ü–†–û–°–¢–ê–Ø –ë–ê–ó–ê –î–ê–ù–ù–´–• =============
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º localStorage –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

            // –ö–ª—é—á –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const STORAGE_KEY = 'trust_tap_users';

            // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            function getAllUsers() {
                try {
                    const data = localStorage.getItem(STORAGE_KEY);
                    return data ? JSON.parse(data) : {};
                } catch (e) {
                    console.error('Error reading from localStorage:', e);
                    return {};
                }
            }

            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            function saveAllUsers(users) {
                try {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(users));
                } catch (e) {
                    console.error('Error saving to localStorage:', e);
                }
            }

            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
            function savePlayerData() {
                try {
                    // Update last active
                    player.lastActive = Date.now();
                    
                    // Save to localStorage for this user (backup)
                    localStorage.setItem('trustTap_player_' + userId, JSON.stringify(player));
                    
                    // Save to global users database
                    const allUsers = getAllUsers();
                    allUsers[userId] = { ...player }; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–ø–∏—é
                    saveAllUsers(allUsers);
                    
                    // Handle referral for new users
                    if (referrerId && !player.referralProcessed && allUsers[referrerId]) {
                        // Add referral to referrer
                        allUsers[referrerId].referrals = (allUsers[referrerId].referrals || 0) + 1;
                        
                        // Give referral bonus to new user
                        player.energy += ECONOMY.tasks.referralBonusEnergy;
                        player.referralProcessed = true;
                        
                        // Update player in allUsers
                        allUsers[userId] = { ...player };
                        
                        // Save all changes
                        saveAllUsers(allUsers);
                        
                        // Update local backup for referrer
                        localStorage.setItem('trustTap_player_' + referrerId, JSON.stringify(allUsers[referrerId]));
                        
                        console.log('‚úÖ Referral processed!');
                    }
                    
                    console.log('üíæ Data saved locally');
                } catch (e) {
                    console.error("Error saving player data:", e);
                }
            }

            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
            function loadPlayerData() {
                return new Promise((resolve) => {
                    try {
                        // Try to load from global users database first
                        const allUsers = getAllUsers();
                        
                        if (allUsers[userId]) {
                            // User exists in global DB
                            player = { ...player, ...allUsers[userId] };
                            console.log('‚úÖ User loaded from global DB');
                        } else {
                            // New user - check local backup
                            const saved = localStorage.getItem('trustTap_player_' + userId);
                            if (saved) {
                                const data = JSON.parse(saved);
                                player = { ...player, ...data };
                                console.log('‚úÖ User loaded from backup');
                            } else {
                                console.log('üÜï New user created');
                                
                                // Handle referral for new user
                                if (referrerId && allUsers[referrerId]) {
                                    // We'll process referral in savePlayerData
                                    player.referralProcessed = false;
                                }
                            }
                        }
                        
                        // Ensure energy doesn't exceed capacity
                        const maxEnergy = getCurrentCapacity();
                        if (player.energy > maxEnergy) {
                            player.energy = maxEnergy;
                        }
                        
                        resolve();
                    } catch (e) {
                        console.error("Error loading player data:", e);
                        resolve();
                    }
                });
            }

            // Admin functions
            let adminData = {
                users: {},
                stats: {
                    totalUsers: 0,
                    activeToday: 0,
                    totalBalance: 0,
                    totalTaps: 0,
                    totalReferrals: 0
                }
            };

            function loadAdminData() {
                // Load all users from localStorage
                const allUsers = getAllUsers();
                adminData.users = allUsers;
                
                // Calculate stats
                const now = Date.now();
                const dayAgo = now - 24 * 60 * 60 * 1000;
                
                let totalBalance = 0;
                let totalTaps = 0;
                let totalReferrals = 0;
                let activeToday = 0;
                
                Object.values(allUsers).forEach(user => {
                    totalBalance += user.balance || 0;
                    totalTaps += user.totalTaps || 0;
                    totalReferrals += user.referrals || 0;
                    if (user.lastActive > dayAgo) activeToday++;
                });
                
                adminData.stats = {
                    totalUsers: Object.keys(allUsers).length,
                    activeToday: activeToday,
                    totalBalance: totalBalance,
                    totalTaps: totalTaps,
                    totalReferrals: totalReferrals
                };
                
                updateAdminUI();
            }

            function updateAdminUI() {
                // Update stats
                document.getElementById('totalUsers').textContent = adminData.stats.totalUsers;
                document.getElementById('activeToday').textContent = adminData.stats.activeToday;
                document.getElementById('totalBalance').textContent = adminData.stats.totalBalance.toFixed(2);
                document.getElementById('totalTaps').textContent = adminData.stats.totalTaps;
                document.getElementById('totalReferrals').textContent = adminData.stats.totalReferrals;
                
                // Update users list
                const usersList = document.getElementById('usersList');
                if (usersList) {
                    usersList.innerHTML = '';
                    
                    const searchTerm = document.getElementById('userSearch')?.value?.toLowerCase() || '';
                    
                    Object.entries(adminData.users).forEach(([id, user]) => {
                        // –ü–æ–∏—Å–∫ –ø–æ ID, –∏–º–µ–Ω–∏ –∏–ª–∏ username
                        const usernameMatch = user.userUsername ? user.userUsername.toLowerCase().includes(searchTerm) : false;
                        if (searchTerm && !id.includes(searchTerm) && !user.userName?.toLowerCase().includes(searchTerm) && !usernameMatch) {
                            return;
                        }
                        
                        const userEl = document.createElement('div');
                        userEl.className = 'user-item';
                        
                        // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É —Å username, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                        let usernameDisplay = '';
                        if (user.userUsername) {
                            usernameDisplay = ` ‚Ä¢ @${user.userUsername}`;
                        }
                        
                        userEl.innerHTML = `
                            <div class="user-info">
                                <div class="user-id">${id}${usernameDisplay}</div>
                                <div class="user-details">${user.userName || 'Unknown'} ‚Ä¢ –£—Ä–æ–≤–Ω–∏: ${user.damageLevel || 1}/${user.capacityLevel || 1}/${user.recoveryLevel || 1}</div>
                            </div>
                            <div class="user-balance">${(user.balance || 0).toFixed(2)} USDT</div>
                        `;
                        userEl.onclick = () => showUserDetails(id, user);
                        usersList.appendChild(userEl);
                    });
                }
                
                // Update task stats
                let subscribeCount = 0, adCount = 0, walletCount = 0;
                Object.values(adminData.users).forEach(user => {
                    if (user.tasks?.subscribe) subscribeCount++;
                    if (user.tasks?.ad) adCount++;
                    if (user.tasks?.wallet) walletCount++;
                });
                
                document.getElementById('taskSubscribeCount').textContent = `${subscribeCount}/${adminData.stats.totalUsers}`;
                document.getElementById('taskAdCount').textContent = `${adCount}/${adminData.stats.totalUsers}`;
                document.getElementById('taskWalletCount').textContent = `${walletCount}/${adminData.stats.totalUsers}`;
                
                // Update referral select
                const select = document.getElementById('referralUserSelect');
                if (select) {
                    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>';
                    Object.entries(adminData.users).forEach(([id, user]) => {
                        const usernameText = user.userUsername ? `(@${user.userUsername})` : '';
                        const option = document.createElement('option');
                        option.value = id;
                        option.textContent = `${id} - ${user.userName || 'Unknown'} ${usernameText} (—Ä–µ—Ñ: ${user.referrals || 0})`;
                        select.appendChild(option);
                    });
                }
            }

            function showUserDetails(userId, userData) {
                // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É —Å username
                const usernameLine = userData.userUsername ? `üì± Username: @${userData.userUsername}\n` : '';
                
                const details = `
                    üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${userData.userName || 'Unknown'}
                    ${usernameLine}ID: ${userId}
                    
                    üí∞ –ë–∞–ª–∞–Ω—Å: ${(userData.balance || 0).toFixed(2)} USDT
                    ‚ö° –≠–Ω–µ—Ä–≥–∏—è: ${userData.energy || 0}/${getCurrentCapacityForUser(userData)}
                    
                    üìä –£—Ä–æ–≤–Ω–∏:
                    ‚Ä¢ –£—Ä–æ–Ω: ${userData.damageLevel || 1}
                    ‚Ä¢ –Å–º–∫–æ—Å—Ç—å: ${userData.capacityLevel || 1}
                    ‚Ä¢ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: ${userData.recoveryLevel || 1}
                    
                    üë• –†–µ—Ñ–µ—Ä–∞–ª—ã: ${userData.referrals || 0}
                    üîó –ü—Ä–∏–≥–ª–∞—à–µ–Ω: ${userData.referrer || '–Ω–µ—Ç'}
                    
                    üìù –ó–∞–¥–∞–Ω–∏—è:
                    ‚Ä¢ –ü–æ–¥–ø–∏—Å–∫–∞: ${userData.tasks?.subscribe ? '‚úÖ' : '‚ùå'}
                    ‚Ä¢ –†–µ–∫–ª–∞–º–∞: ${userData.tasks?.ad ? '‚úÖ' : '‚ùå'}
                    ‚Ä¢ –ö–æ—à–µ–ª–µ–∫: ${userData.tasks?.wallet ? '‚úÖ' : '‚ùå'}
                    
                    üïê –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥: ${new Date(userData.lastActive || 0).toLocaleString()}
                    üìÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: ${new Date(userData.createdAt || 0).toLocaleString()}
                `;
                alert(details);
            }

            function getCurrentCapacityForUser(userData) {
                return Math.floor(ECONOMY.energy.baseCapacity * ECONOMY.upgrades.capacity[(userData.capacityLevel || 1) - 1]);
            }

            // UI update function
            function updateUI() {
                document.getElementById('balanceDisplay').textContent = formatUSDT(player.balance);
                
                const maxEnergy = getCurrentCapacity();
                document.getElementById('energyDisplay').textContent = Math.floor(player.energy);
                document.getElementById('energyBarFill').style.width = `${(player.energy / maxEnergy) * 100}%`;
                document.getElementById('regenTip').textContent = `+${getCurrentRecovery().toFixed(1)}/—Å–µ–∫`;
                
                document.getElementById('tapValueDisplay').textContent = `${getCurrentTapValue()} USDT –∑–∞ —Ç–∞–ø`;
                document.getElementById('refCount').textContent = player.referrals;
                
                document.getElementById('damageValue').textContent = `${ECONOMY.upgrades.damage[player.damageLevel-1].toFixed(1)}x`;
                document.getElementById('damageLevel').textContent = `—É—Ä. ${player.damageLevel}`;
                document.getElementById('capacityValue').textContent = getCurrentCapacity();
                document.getElementById('capacityLevel').textContent = `—É—Ä. ${player.capacityLevel}`;
                document.getElementById('recoveryValue').textContent = `${getCurrentRecovery().toFixed(1)}/—Å–µ–∫`;
                document.getElementById('recoveryLevel').textContent = `—É—Ä. ${player.recoveryLevel}`;
                
                // Update task button states
                const subscribeBtn = document.querySelector('[data-task="subscribe"]');
                const adBtn = document.querySelector('[data-task="ad"]');
                const walletBtn = document.querySelector('[data-task="wallet"]');
                
                if (subscribeBtn) subscribeBtn.textContent = player.tasks.subscribe ? '‚úÖ' : '–°—Ç–∞—Ä—Ç';
                if (adBtn) adBtn.textContent = player.tasks.ad ? '‚úÖ' : '–°—Ç–∞—Ä—Ç';
                if (walletBtn) walletBtn.textContent = player.tasks.wallet ? '‚úÖ' : '–°—Ç–∞—Ä—Ç';
            }

            // Floating animation
            function showFloating(text, color, x, y) {
                const div = document.createElement('div');
                div.className = 'floating-value';
                div.textContent = text;
                
                const randomOffsetX = (Math.random() - 0.5) * 40; 
                const randomOffsetY = (Math.random() - 0.5) * 40; 
                
                div.style.left = `${x + randomOffsetX}px`;
                div.style.top = `${y + randomOffsetY}px`;
                
                document.body.appendChild(div);
                setTimeout(() => { if (div.parentNode) div.remove(); }, 800);
            }

            // Vibration
            function vibrate() {
                try {
                    if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.HapticFeedback) {
                        window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
                    } else if (navigator.vibrate) {
                        navigator.vibrate(10);
                    }
                } catch(e) {}
            }

            // Tap handler
            function processTap(clientX, clientY) {
                vibrate(); 
                
                if (player.energy < ECONOMY.energy.tapCost) {
                    showFloating('‚ö°', '#ffa38b', clientX, clientY);
                    return;
                }
                
                const tapValue = parseFloat(getCurrentTapValue());
                player.energy -= ECONOMY.energy.tapCost;
                player.balance = parseFloat((player.balance + tapValue).toFixed(6));
                player.totalTaps = (player.totalTaps || 0) + 1;
                
                showFloating(`+${tapValue.toFixed(4)}`, null, clientX, clientY);
                updateUI();
                savePlayerData();
            }

            // Upgrade purchase
            function purchaseUpgrade(type) {
                const currentLevel = player[`${type}Level`];
                if (currentLevel >= 10) { 
                    alert('‚ùå –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å'); 
                    return; 
                }
                
                const price = ECONOMY.upgradePrices[type][currentLevel - 1];
                if (player.balance < price) { 
                    alert(`‚ùå –ù—É–∂–Ω–æ –µ—â–µ ${(price - player.balance).toFixed(2)} USDT`); 
                    return; 
                }
                
                if (confirm(`‚úÖ –£–ª—É—á—à–∏—Ç—å –∑–∞ ${price.toFixed(2)} USDT?`)) {
                    vibrate(); 
                    player.balance = parseFloat((player.balance - price).toFixed(6));
                    player[`${type}Level`]++;
                    if (type === 'capacity') { 
                        player.energy = getCurrentCapacity(); 
                    }
                    showFloating('UP', null, window.innerWidth / 2, window.innerHeight / 2);
                    updateUI();
                    savePlayerData();
                }
            }

            // Task handlers
            function handleTaskSubscribe() {
                if (player.tasks.subscribe) {
                    alert('‚ùå –ó–∞–¥–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ');
                    return;
                }
                
                player.balance = parseFloat((player.balance + ECONOMY.tasks.subscription).toFixed(6));
                player.tasks.subscribe = true;
                showFloating(`+${ECONOMY.tasks.subscription.toFixed(2)}`, null, window.innerWidth / 2, window.innerHeight / 2);
                updateUI();
                savePlayerData();
                alert('‚úÖ –í—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª! +0.80 USDT');
            }

            function handleTaskAd() {
                if (player.tasks.ad) {
                    alert('‚ùå –ó–∞–¥–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ');
                    return;
                }
                
                player.balance = parseFloat((player.balance + ECONOMY.tasks.adReward).toFixed(6));
                player.tasks.ad = true;
                showFloating(`+${ECONOMY.tasks.adReward.toFixed(2)}`, null, window.innerWidth / 2, window.innerHeight / 2);
                updateUI();
                savePlayerData();
                alert('‚úÖ –†–µ–∫–ª–∞–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–∞! +0.20 USDT');
            }

            function handleTaskWallet() {
                if (player.tasks.wallet) {
                    alert('‚ùå –ó–∞–¥–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ');
                    return;
                }
                
                player.balance = parseFloat((player.balance + ECONOMY.tasks.walletReward).toFixed(6));
                player.tasks.wallet = true;
                showFloating(`+22.50`, null, window.innerWidth / 2, window.innerHeight / 2);
                updateUI();
                savePlayerData();
                alert('‚úÖ –ö–æ—à–µ–ª—ë–∫ –ø—Ä–∏–≤—è–∑–∞–Ω! +22.50 USDT');
            }

            // Background decoration
            function createHandwrittenBg() {
                const bgContainer = document.getElementById('handwrittenBg');
                if (!bgContainer) return;
                bgContainer.innerHTML = '';
                for (let i = 0; i < 120; i++) {
                    const span = document.createElement('span');
                    span.textContent = 'T';
                    span.style.left = Math.random() * 100 + '%';
                    span.style.top = Math.random() * 100 + '%';
                    span.style.setProperty('--r', (Math.random() * 60) - 30);
                    span.style.setProperty('--d', Math.random() * 8);
                    span.style.fontSize = (0.8 + Math.random() * 1.5) + 'rem';
                    span.style.opacity = 0.25 + Math.random() * 0.35;
                    bgContainer.appendChild(span);
                }
            }

            // Initialize
            async function init() {
                createHandwrittenBg();
                
                // Load player data
                await loadPlayerData();
                
                // Set initial energy
                player.energy = Math.min(player.energy, getCurrentCapacity());
                
                // Setup event listeners
                const tapZone = document.getElementById('tapButton');
                const bigCoin = document.querySelector('.big-coin');

                tapZone.addEventListener('touchstart', (e) => {
                    e.preventDefault(); 
                    bigCoin.classList.add('pressed'); 
                    
                    for (let i = 0; i < e.changedTouches.length; i++) {
                        const touch = e.changedTouches[i];
                        processTap(touch.clientX, touch.clientY);
                    }
                }, { passive: false });

                tapZone.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    if (e.touches.length === 0) {
                        bigCoin.classList.remove('pressed'); 
                    }
                });

                tapZone.addEventListener('mousedown', (e) => {
                    bigCoin.classList.add('pressed');
                    processTap(e.clientX, e.clientY);
                });
                tapZone.addEventListener('mouseup', () => bigCoin.classList.remove('pressed'));
                tapZone.addEventListener('mouseleave', () => bigCoin.classList.remove('pressed'));
                
                // Upgrade buttons
                document.querySelectorAll('.upgrade-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => { 
                        e.stopPropagation(); 
                        purchaseUpgrade(e.target.dataset.type); 
                    });
                });
                
                // Task buttons
                document.querySelectorAll('.task-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const task = e.target.dataset.task;
                        switch(task) {
                            case 'subscribe': handleTaskSubscribe(); break;
                            case 'ad': handleTaskAd(); break;
                            case 'wallet': handleTaskWallet(); break;
                            case 'blum': alert('‚ùå –ö–≤–µ—Å—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); break;
                        }
                    });
                });
                
                // Referral bar
                document.getElementById('topRefBar').addEventListener('click', () => {
                    const referralLink = `https://t.me/teosoaodosabot?start=${userId}`;
                    navigator.clipboard.writeText(referralLink).then(() => {
                        alert('üîó –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
                    }).catch(() => {
                        prompt('–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:', referralLink);
                    });
                });

                // Rank card
                document.getElementById('rankCard').addEventListener('click', () => { 
                    alert('üèÜ –í–∞—à —Ä–∞–Ω–≥: –ë—Ä–æ–Ω–∑–∞'); 
                });
                
                // Energy regeneration
                setInterval(() => {
                    const maxEnergy = getCurrentCapacity();
                    if (player.energy < maxEnergy) {
                        player.energy = Math.min(maxEnergy, player.energy + getCurrentRecovery());
                        updateUI();
                        savePlayerData();
                    }
                }, 1000);
                
                // Auto-save every 30 seconds
                setInterval(() => {
                    savePlayerData();
                }, 30000);
                
                // Admin panel
                const adminBtn = document.getElementById('adminBtn');
                const adminPanel = document.getElementById('adminPanel');
                const adminClose = document.getElementById('adminClose');
                const adminTabs = document.querySelectorAll('.admin-tab');
                const userSearch = document.getElementById('userSearch');
                
                // Check if user is admin
                const ADMIN_IDS = ['7734938819', '987654321']; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–∏ ID
                const isAdmin = ADMIN_IDS.includes(userId);
                
                if (isAdmin) {
                    adminBtn.style.display = 'flex';
                    
                    adminBtn.addEventListener('click', () => {
                        adminPanel.classList.add('active');
                        loadAdminData();
                        
                        // Auto-refresh every 10 seconds
                        if (window.adminRefreshInterval) clearInterval(window.adminRefreshInterval);
                        window.adminRefreshInterval = setInterval(loadAdminData, 10000);
                    });
                    
                    adminClose.addEventListener('click', () => {
                        adminPanel.classList.remove('active');
                        if (window.adminRefreshInterval) {
                            clearInterval(window.adminRefreshInterval);
                            window.adminRefreshInterval = null;
                        }
                    });
                    
                    // Tab switching
                    adminTabs.forEach(tab => {
                        tab.addEventListener('click', () => {
                            adminTabs.forEach(t => t.classList.remove('active'));
                            tab.classList.add('active');
                            
                            document.querySelectorAll('.admin-tab-content').forEach(content => {
                                content.classList.remove('active');
                            });
                            document.getElementById(`tab-${tab.dataset.tab}`).classList.add('active');
                        });
                    });
                    
                    // User search
                    if (userSearch) {
                        userSearch.addEventListener('input', () => {
                            updateAdminUI();
                        });
                    }
                    
                    // Referral tree
                    const referralSelect = document.getElementById('referralUserSelect');
                    if (referralSelect) {
                        referralSelect.addEventListener('change', (e) => {
                            const selectedUserId = e.target.value;
                            if (!selectedUserId || !adminData.users[selectedUserId]) return;
                            
                            buildReferralTree(selectedUserId);
                        });
                    }
                } else {
                    adminBtn.style.display = 'none';
                }
                
                function buildReferralTree(userId) {
                    const tree = document.getElementById('referralTree');
                    if (!tree) return;
                    
                    const user = adminData.users[userId];
                    if (!user) return;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º username –µ—Å–ª–∏ –µ—Å—Ç—å
                    const usernameText = user.userUsername ? `(@${user.userUsername})` : '';
                    
                    let html = `<div class="tree-node-content">üë§ ${userId} ${usernameText} (${user.referrals || 0} —Ä–µ—Ñ)</div>`;
                    
                    // Find referrals
                    const referrals = Object.entries(adminData.users)
                        .filter(([id, u]) => u.referrer === userId);
                    
                    if (referrals.length > 0) {
                        html += '<div class="tree-node">';
                        referrals.forEach(([id, refUser]) => {
                            const refUsernameText = refUser.userUsername ? `(@${refUser.userUsername})` : '';
                            html += `<div class="tree-node-content">‚îî‚îÄ üë§ ${id} ${refUsernameText} (${refUser.referrals || 0} —Ä–µ—Ñ)</div>`;
                        });
                        html += '</div>';
                    }
                    
                    tree.innerHTML = html;
                }
                
                // Initial UI update
                updateUI();
                
                // Save initial data
                savePlayerData();
            }

            // Start the game
            init();
        })();
    </script>
</body>
</html>
