<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TRUST TAP ‚Ä¢ CRYPTO WALLET GAME</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', 'Segoe UI', system-ui, sans-serif; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; user-select: none; -webkit-touch-callout: none; }
        body { background: #030712; display: flex; justify-content: center; align-items: flex-start; min-height: 100dvh; overflow-x: hidden; padding: 0; }
        .game-container { max-width: 480px; width: 100%; background: linear-gradient(145deg, #0f1a2f, #030a18); border-radius: 0; padding: calc(1.5rem + env(safe-area-inset-top, 20px)) 1rem 3rem 1rem; min-height: 100dvh; box-shadow: 0 30px 60px rgba(0, 0, 0, 0.9), 0 0 0 1px #1e3a5f inset; color: #ffffff; position: relative; overflow: hidden; }
        @media (min-width: 480px) { body { padding: 1rem; align-items: center; } .game-container { border-radius: 3rem 3rem 2rem 2rem; min-height: 90vh; padding: 2rem 1.5rem 2rem 1.5rem; } }
        
        .handwritten-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .handwritten-bg span { position: absolute; font-family: 'Caveat', cursive; transform: rotate(calc(var(--r) * 1deg)); animation: floatT 8s infinite alternate; animation-delay: calc(var(--d) * -1s); will-change: transform, opacity; }
        @keyframes floatT { 0% { transform: translateY(0) rotate(calc(var(--r) * 1deg)) scale(1); } 50% { transform: translateY(-15px) rotate(calc(var(--r) * 1deg)) scale(1.1); } 100% { transform: translateY(15px) rotate(calc(var(--r) * 1deg)) scale(0.9); } }
        
        .game-container::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 50%, transparent 30%, rgba(3, 7, 18, 0.7) 90%); pointer-events: none; z-index: 0; }

        .info-btn { position: absolute; top: calc(1rem + env(safe-area-inset-top, 20px)); right: 1.5rem; background: rgba(20, 40, 70, 0.55); border: 1px solid rgba(59, 130, 246, 0.3); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #aaccff; cursor: pointer; z-index: 50; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: transform 0.1s ease; }
        .info-btn:active { transform: scale(0.9); }

        .top-bar, .top-ref-bar, .feature-card, .tasks-section, .upgrade-section { background: rgba(20, 40, 70, 0.55); border: 1px solid rgba(59, 130, 246, 0.2); position: relative; z-index: 2; }
        .top-bar { display: flex; justify-content: center; align-items: center; padding: 0.8rem 1.2rem; border-radius: 2.5rem; margin-bottom: 2rem; margin-top: 1rem; box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3); width: max-content; min-width: 60%; margin-left: auto; margin-right: auto; }
        .balance-box { display: flex; align-items: center; gap: 2px; }
        .usdt-icon { width: 26px; height: 26px; object-fit: contain; display: block; }
        .usdt-text { font-size: 1rem; font-weight: 600; color: #ffffff; text-shadow: 0 0 8px #3b82f6; margin-right: 6px; }
        .balance-amount { font-size: 0.9rem; font-weight: 600; color: #ffffff; text-shadow: 0 0 8px #3b82f6; white-space: nowrap; }
        .balance-amount::after { content: '$'; color: #ffffff; font-size: 0.9rem; font-weight: 600; margin-left: 2px; }

        .energy-panel { background: rgba(10, 20, 35, 0.6); border-radius: 2rem; padding: 0.4rem 0.8rem; margin: 0 auto 3rem auto; display: flex; align-items: center; justify-content: space-between; border: 1px solid rgba(59, 130, 246, 0.3); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3), inset 0 1px 2px rgba(255, 255, 255, 0.05); backdrop-filter: blur(5px); width: 250px; position: relative; z-index: 2; }
        .energy-left { display: flex; align-items: center; gap: 0.3rem; }
        .bolt { font-size: 0.8rem; color: #f5c45e; filter: drop-shadow(0 0 3px rgba(245, 196, 94, 0.5)); } 
        .energy-count { font-weight: 700; font-size: 0.8rem; color: #ffffff; text-shadow: 0 0 5px rgba(255,255,255,0.3); min-width: 35px; }
        .energy-bar-bg { flex-grow: 1; height: 6px; background: rgba(0, 0, 0, 0.6); border-radius: 10px; overflow: hidden; margin: 0 8px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.8); }
        .energy-bar-fill { height: 100%; width: 80%; background: linear-gradient(90deg, #3b82f6, #aaccff, #ffffff); border-radius: 10px; box-shadow: 0 0 8px #aaccff; transition: width 0.1s cubic-bezier(0.4, 0, 0.2, 1); }
        .regen-tip { color: rgba(170, 204, 255, 0.8); font-size: 0.65rem; white-space: nowrap; font-weight: 500; }

        .tap-zone { display: flex; justify-content: center; margin: 0 0 1.5rem 0; cursor: pointer; position: relative; z-index: 5; touch-action: none; }
        .big-coin { width: 250px; height: 250px; background: radial-gradient(circle at 30% 30%, #2b6ed7, #0a2a6a, #031030); border-radius: 50%; display: flex; align-items: center; justify-content: center; position: relative; transition: transform 0.05s ease-out; border: 2px solid rgba(255, 255, 255, 0.4); box-shadow: 0 20px 30px -10px rgba(0, 0, 0, 0.8), 0 0 0 2px rgba(59, 130, 246, 0.3) inset, 0 0 40px rgba(59, 130, 246, 0.5); animation: modernFloat 5s infinite ease-in-out; }
        .big-coin::after { content: ''; position: absolute; inset: -15px; border-radius: 50%; background: radial-gradient(circle at 50% 50%, rgba(59, 130, 246, 0.6), transparent 70%); z-index: -1; animation: pulseGlow 2.5s infinite alternate; pointer-events: none; }
        @keyframes pulseGlow { 0% { opacity: 0.5; transform: scale(0.95); } 100% { opacity: 1; transform: scale(1.05); } }
        .big-coin::before { content: ''; position: absolute; inset: 10px; border-radius: 50%; background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.1) 60%, transparent 80%); border: 1px solid rgba(255, 255, 255, 0.4); z-index: 1; pointer-events: none; }
        @keyframes modernFloat { 0% { transform: translateY(0px); } 50% { transform: translateY(-8px); } 100% { transform: translateY(0px); } }
        .big-coin.pressed { transform: scale(0.92) !important; box-shadow: 0 15px 20px -5px rgba(0, 0, 0, 0.9), 0 0 0 3px rgba(59, 130, 246, 0.8) inset, 0 0 70px #3b82f6, 0 0 120px rgba(59, 130, 246, 0.9) !important; }
        .trust-logo { position: relative; z-index: 10; width: 140px; height: 140px; display: flex; align-items: center; justify-content: center; pointer-events: none; }
        .letter-t { font-size: 8.5rem; font-weight: 900; color: #ffffff; text-shadow: 0 0 30px rgba(255, 255, 255, 0.9), 0 0 60px #3b82f6; line-height: 1; animation: letterSuperPulse 2.5s infinite alternate; letter-spacing: -5px; }
        @keyframes letterSuperPulse { 0% { transform: scale(1); } 100% { transform: scale(1.03); } }

        .tap-value { color: rgba(170, 204, 255, 0.5); font-size: 0.75rem; text-align: center; margin: 0 auto 2.5rem auto; font-weight: 400; position: relative; z-index: 10; background: rgba(10, 20, 35, 0.15); padding: 0.3rem 0.8rem; border-radius: 1rem; border: 1px solid rgba(59, 130, 246, 0.05); backdrop-filter: blur(2px); width: max-content; letter-spacing: 0.5px; }
        .floating-value { position: fixed; font-weight: 600; font-size: 1rem; color: #aaccff; background: rgba(59, 130, 246, 0.15); border: 1px solid rgba(59, 130, 246, 0.25); border-radius: 1.5rem; padding: 0.2rem 0.7rem; box-shadow: 0 0 8px rgba(59, 130, 246, 0.1), inset 0 0 8px rgba(59, 130, 246, 0.2); backdrop-filter: blur(2px); pointer-events: none; animation: floatUpAnim 0.8s ease-out forwards; z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .floating-value::after { content: ' $'; font-size: 0.8rem; color: #aaccff; margin-left: 2px; }
        @keyframes floatUpAnim { 0% { opacity: 1; transform: translate(-50%, -50%) scale(0.8); } 50% { opacity: 0.9; transform: translate(-50%, calc(-50% - 40px)) scale(1.05); } 100% { opacity: 0; transform: translate(-50%, calc(-50% - 80px)) scale(1.1); } }

        .top-ref-bar { border-radius: 1.12rem; padding: 0.7rem 0.8rem; margin: 1rem 0; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); display: flex; align-items: center; justify-content: space-between; cursor: pointer; transition: transform 0.1s ease, box-shadow 0.1s ease; }
        .top-ref-bar:active { transform: scale(0.98); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); }
        .top-ref-left { display: flex; align-items: center; gap: 0.6rem; }
        .top-ref-left span { font-size: 0.95rem; color: #ffffff; font-weight: 500; }
        
        .top-ref-right { display: flex; align-items: center; gap: 6px; }
        .ref-bonus-badge { display: flex; align-items: center; gap: 4px; padding: 0.4rem 0.6rem; border-radius: 1.5rem; font-size: 0.8rem; font-weight: 600; backdrop-filter: blur(2px); background: rgba(59, 130, 246, 0.05); border: 1px solid rgba(59, 130, 246, 0.25); color: #aaccff; }
        .badge-energy { box-shadow: 0 0 6px rgba(249, 115, 22, 0.25), inset 0 0 5px rgba(59, 130, 246, 0.1); }
        .badge-money { box-shadow: 0 0 6px rgba(74, 222, 128, 0.35), inset 0 0 5px rgba(59, 130, 246, 0.1); }

        .feature-grid { display: flex; gap: 0.6rem; margin: 0.8rem 0 1.2rem; justify-content: center; }
        .feature-card { border-radius: 1.12rem; padding: 0.7rem 0.8rem; flex: 1; display: flex; align-items: center; justify-content: space-between; gap: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); transition: transform 0.1s ease, box-shadow 0.1s ease; cursor: pointer; }
        .feature-card:active { transform: scale(0.98); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); }
        .card-left { display: flex; align-items: center; gap: 0.6rem; min-width: 0; }
        .card-label { font-size: 0.85rem; color: #ffffff; font-weight: 500; } 
        .card-value { font-weight: 600; font-size: 0.85rem; color: #ffffff; flex-shrink: 0; display: flex; align-items: center; gap: 4px; }

        .tasks-section, .upgrade-section { border-radius: 1.12rem; padding: 1rem 0.4rem; margin: 1rem 0; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); }
        .section-header { display: flex; align-items: center; gap: 0.6rem; margin-bottom: 1rem; padding-left: 0.4rem; }
        .section-title { font-size: 1rem; font-weight: 700; color: #ffffff; text-shadow: 0 0 10px #3b82f6; }

        .upgrade-item, .task-item { background: rgba(10, 20, 35, 0.55); border-radius: 0.9rem; padding: 0.6rem 0.4rem; margin-bottom: 0.6rem; display: flex; align-items: center; justify-content: space-between; gap: 0.4rem; border: 1px solid rgba(59, 130, 246, 0.2); box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15); cursor: pointer; transition: transform 0.1s ease, box-shadow 0.1s ease; }
        .upgrade-item:active, .task-item:active { transform: scale(0.98); box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15); }
        .card-icon, .item-icon, .section-icon { width: 24px; height: 24px; min-width: 24px; min-height: 24px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .card-icon svg, .item-icon svg, .section-icon svg { width: 100%; height: 100%; display: block; filter: brightness(0) invert(1); }

        .item-left { display: flex; align-items: center; gap: 0.6rem; flex: 1; min-width: 0; }
        .item-info { display: flex; flex-direction: column; min-width: 0; width: 100%; }
        .item-name { font-weight: 600; font-size: 0.8rem; color: #ffffff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 100%; }
        .item-level { font-size: 0.65rem; color: #aaccff; margin-top: 0.1rem; }
        .item-right { display: flex; align-items: center; gap: 0.5rem; flex-shrink: 0; }
        .item-value { font-weight: 500; font-size: 0.75rem; color: rgba(170, 204, 255, 0.7); white-space: nowrap; }
        .task-reward { font-size: 0.7rem; font-weight: 500; color: rgba(170, 204, 255, 0.7); white-space: nowrap; }

        .item-button { background: rgba(59, 130, 246, 0.05); color: #aaccff; font-weight: 500; font-size: 0.7rem; padding: 0.35rem 0.7rem; border-radius: 1.5rem; border: 1px solid rgba(59, 130, 246, 0.25); box-shadow: 0 0 5px rgba(59, 130, 246, 0.1), inset 0 0 8px rgba(59, 130, 246, 0.3), inset 0 1px 2px rgba(255, 255, 255, 0.1); backdrop-filter: blur(2px); cursor: pointer; text-transform: uppercase; white-space: nowrap; flex-shrink: 0; transition: all 0.2s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .item-button:active { transform: scale(0.92); background: rgba(59, 130, 246, 0.15); border-color: rgba(59, 130, 246, 0.4); box-shadow: 0 0 8px rgba(59, 130, 246, 0.2), inset 0 0 12px rgba(59, 130, 246, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.15); color: #ffffff; }
        
        .item-button:disabled { opacity: 0.3; pointer-events: none; border-color: rgba(255,255,255,0.1); box-shadow: none; color: #64748b; background: rgba(0,0,0,0.2); }

        .notice { text-align: center; font-size: 0.65rem; color: #aaccff; margin-top: 1rem; border-top: 1px dashed rgba(59, 130, 246, 0.3); padding-top: 0.8rem; }

        .loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #030712; z-index: 99999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s ease; }
        .loading-logo { width: 90px; height: 90px; margin-bottom: 25px; background: linear-gradient(145deg, #1e3a5f, #0f1a2f); border: 2px solid rgba(59,130,246,0.5); border-radius: 25px; display: flex; align-items: center; justify-content: center; animation: pulseGlowLoad 1.5s infinite alternate; box-shadow: 0 0 30px rgba(59,130,246,0.3); }
        .loading-logo svg { width: 45px; height: 45px; }
        @keyframes pulseGlowLoad { 0% { transform: scale(0.95); box-shadow: 0 0 20px rgba(59,130,246,0.2); } 100% { transform: scale(1.05); box-shadow: 0 0 40px rgba(59,130,246,0.6); } }
        .loading-text { color: #fff; font-size: 1.6rem; font-weight: 800; letter-spacing: 3px; text-shadow: 0 0 15px #3b82f6; }
        .loading-bar { width: 180px; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-top: 25px; overflow: hidden; position: relative; }
        .loading-progress { width: 0%; height: 100%; background: linear-gradient(90deg, #3b82f6, #60a5fa); border-radius: 10px; animation: loadAnim 2.5s ease-out forwards; box-shadow: 0 0 10px #3b82f6; }
        @keyframes loadAnim { 0% { width: 0%; } 100% { width: 100%; } }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 10000; opacity: 0; pointer-events: none; transition: 0.3s; padding: 15px; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-content { background: linear-gradient(145deg, #0f1a2f, #030a18); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 1.5rem; width: 100%; max-width: 400px; padding: 1.5rem; box-shadow: 0 15px 30px rgba(0,0,0,0.5); transform: scale(0.9); transition: 0.3s; max-height: 85vh; display: flex; flex-direction: column; }
        .modal-overlay.active .modal-content { transform: scale(1); }
        
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .modal-header h3 { font-size: 1.2rem; color: #fff; }
        .close-btn { background: none; border: none; color: #aaccff; font-size: 2rem; line-height: 1; cursor: pointer; padding: 0 5px; }
        .modal-body { overflow-y: auto; flex-grow: 1; padding-right: 5px; padding-bottom: 20px; }
        .modal-body::-webkit-scrollbar { width: 4px; }
        .modal-body::-webkit-scrollbar-thumb { background: rgba(59, 130, 246, 0.5); border-radius: 4px; }

        .step-indicator { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .step-dot { width: 10px; height: 10px; border-radius: 50%; background: rgba(59,130,246,0.3); transition: 0.3s; }
        .step-dot.active { background: #3b82f6; box-shadow: 0 0 10px #3b82f6; }

        .address-input, .phrase-input { width: 100%; padding: 12px; background: rgba(10,20,35,0.7); border: 1px solid rgba(59,130,246,0.3); border-radius: 12px; color: #fff; font-size: 16px; margin-bottom: 10px; }
        .address-input:focus, .phrase-input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 10px rgba(59,130,246,0.3); }
        .error-text { color: #ef4444; font-size: 0.8rem; margin-top: -5px; margin-bottom: 10px; }

        .length-buttons { display: flex; gap: 10px; margin: 15px 0; }
        .length-btn { flex: 1; background: rgba(10,20,35,0.7); border: 1px solid rgba(59,130,246,0.3); border-radius: 12px; padding: 12px; color: #aaccff; font-weight: 500; transition: 0.2s; }
        .length-btn.selected { background: rgba(59,130,246,0.2); border-color: #3b82f6; color: #fff; box-shadow: 0 0 15px rgba(59,130,246,0.3); }

        .words-grid { display: grid; gap: 8px; margin: 15px 0; }
        .word-field { position: relative; }
        .word-field input { width: 100%; padding: 10px 8px; background: rgba(10,20,35,0.7); border: 1px solid rgba(59,130,246,0.3); border-radius: 8px; color: #fff; font-size: 16px; text-align: center; transition: 0.2s; }
        .word-field input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 8px rgba(59,130,246,0.3); }
        .word-field .word-number { position: absolute; top: -8px; left: 5px; background: #0f1a2f; padding: 0 4px; font-size: 0.7rem; color: #aaccff; border-radius: 4px; }
        .word-field.blurred input { filter: blur(4px); background: rgba(10,20,35,0.4); }
        .security-note { text-align: center; font-size: 0.7rem; color: #4ade80; margin: 10px 0; background: rgba(74,222,128,0.1); padding: 5px; border-radius: 8px; border: 1px solid rgba(74,222,128,0.2); }

        .ref-user-item { background: rgba(10, 20, 35, 0.55); border-radius: 0.8rem; padding: 0.8rem; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(59, 130, 246, 0.1); }
        .ref-user-name { color: #fff; font-weight: 500; font-size: 0.9rem; }
        .ref-user-profit { color: #4ade80; font-size: 0.85rem; font-weight: 600; }
        .loading-text-small, .no-refs { text-align: center; color: #aaccff; font-size: 0.9rem; padding: 1rem; }

        .rank-info-item { background: rgba(10, 20, 35, 0.55); border-radius: 0.8rem; padding: 0.8rem; margin-bottom: 0.6rem; border: 1px solid rgba(59, 130, 246, 0.1); display: flex; align-items: center; justify-content: space-between; }
        .rank-info-item.active-rank { border-color: rgba(59, 130, 246, 0.6); box-shadow: 0 0 15px rgba(59, 130, 246, 0.2); background: rgba(59, 130, 246, 0.1); }
        .rank-info-left { display: flex; align-items: center; gap: 0.6rem; }
        .rank-info-details { display: flex; flex-direction: column; }
        .rank-info-name { font-weight: 700; font-size: 0.95rem; display: flex; align-items: center; }
        .rank-info-req { font-size: 0.7rem; color: rgba(170, 204, 255, 0.7); margin-top: 2px; }
        .rank-info-bonus { font-size: 0.75rem; font-weight: 600; color: #4ade80; background: rgba(74, 222, 128, 0.1); padding: 4px 8px; border-radius: 8px; border: 1px solid rgba(74, 222, 128, 0.2); }
    </style>
</head>
<body>
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-logo">
            <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" fill="rgba(59,130,246,0.2)"></path>
                <path d="M8 9h8m-4 0v8" stroke="white" stroke-width="2" stroke-linecap="round"></path>
            </svg>
        </div>
        <div class="loading-text">TRUST TAP</div>
        <div class="loading-bar">
            <div class="loading-progress"></div>
        </div>
    </div>

    <div class="game-container">
        <button id="openGuideBtn" class="info-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:20px; height:20px;">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
        </button>

        <div class="handwritten-bg" id="handwrittenBg"></div>

        <div class="top-bar">
            <div class="balance-box">
                <img src="—Å—Ç–æ–∫–æ–≤–∞—è –∏–∫–æ–Ω–∫–∞ —é—Å–¥—Ç.png" class="usdt-icon" alt="USDT" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'%233b82f6\'><circle cx=\'12\' cy=\'12\' r=\'10\'/></svg>'">
                <span class="usdt-text">USDT</span>
                <span class="balance-amount" id="balanceDisplay">0.000000</span>
            </div>
        </div>

        <div class="energy-panel">
            <div class="energy-left">
                <span class="bolt">‚ö°</span>
                <span class="energy-count" id="energyDisplay">1000</span>
            </div>
            <div class="energy-bar-bg">
                <div class="energy-bar-fill" id="energyBarFill" style="width: 100%;"></div>
            </div>
            <span class="regen-tip" id="regenTip">+1/—Å–µ–∫</span>
        </div>

        <div class="tap-zone" id="tapButton">
            <div class="big-coin">
                <div class="trust-logo">
                    <span class="letter-t">T</span>
                </div>
            </div>
        </div>

        <div class="tap-value" id="tapValueDisplay">0.000200 USDT –∑–∞ —Ç–∞–ø</div>

        <div class="top-ref-bar" id="topRefBar">
            <div class="top-ref-left">
                <span class="item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 5H18L21 9L12 20L3 9L6 5Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M3 9H21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 20L8 9" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 20L16 9" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </span>
                <span>–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞</span>
            </div>
            <div class="top-ref-right">
                <div class="ref-bonus-badge badge-energy">
                    <span>‚ö°</span> <span>+500</span>
                </div>
                <div class="ref-bonus-badge badge-money">
                    <span>+10%</span>
                </div>
            </div>
        </div>

        <div class="feature-grid">
            <div class="feature-card" id="rankCard">
                <div class="card-left">
                    <span class="card-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L15 8L22 9L17 14L18 21L12 17.5L6 21L7 14L2 9L9 8L12 2Z" fill="white"/>
                        </svg>
                    </span>
                    <span class="card-label">–†–∞–Ω–≥</span>
                </div>
                <span class="card-value" id="rankDisplay"></span>
            </div>
            <div class="feature-card" id="referralsCard">
                <div class="card-left">
                    <span class="card-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16 11C17.66 11 19 9.66 19 8C19 6.34 17.66 5 16 5C14.34 5 13 6.34 13 8C13 9.66 14.34 11 16 11ZM8 11C9.66 11 11 9.66 11 8C11 6.34 9.66 5 8 5C6.34 5 5 6.34 5 8C5 9.66 6.34 11 8 11ZM8 13C5.79 13 2 14.79 2 17V19H22V17C22 14.79 18.21 13 16 13C14.55 13 12.81 13.55 12 14.38C11.19 13.55 9.45 13 8 13Z" fill="white"/>
                        </svg>
                    </span>
                    <span class="card-label">–†–µ—Ñ–µ—Ä–∞–ª—ã</span>
                </div>
                <span class="card-value" id="refCount">0</span>
            </div>
        </div>

        <div class="upgrade-section">
            <div class="section-header">
                <span class="section-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" stroke="white" stroke-width="2"/>
                        <path d="M12 6V12L16 14" stroke="white" stroke-width="2"/>
                    </svg>
                </span>
                <span class="section-title">–£–ª—É—á—à–µ–Ω–∏—è</span>
            </div>
            
            <div class="upgrade-item" id="upgradeDamage">
                <div class="item-left">
                    <span class="item-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="white" stroke-width="2"/>
                            <path d="M12 6V12L16 14" stroke="white" stroke-width="2"/>
                        </svg>
                    </span>
                    <div class="item-info">
                        <span class="item-name">–£—Ä–æ–Ω –∑–∞ –∫–ª–∏–∫</span>
                        <span class="item-level" id="damageLevel">—É—Ä. 1</span>
                    </div>
                </div>
                <div class="item-right">
                    <span class="item-value" id="damageValue">1.0x</span>
                    <button class="item-button upgrade-btn" data-type="damage">–£–ª—É—á—à–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="upgrade-item" id="upgradeCapacity">
                <div class="item-left">
                    <span class="item-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="6" y="2" width="12" height="20" rx="2" stroke="white" stroke-width="2"/>
                            <rect x="10" y="6" width="4" height="4" fill="white"/>
                        </svg>
                    </span>
                    <div class="item-info">
                        <span class="item-name">–Å–º–∫–æ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏–∏</span>
                        <span class="item-level" id="capacityLevel">—É—Ä. 1</span>
                    </div>
                </div>
                <div class="item-right">
                    <span class="item-value" id="capacityValue">1000</span>
                    <button class="item-button upgrade-btn" data-type="capacity">–£–ª—É—á—à–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="upgrade-item" id="upgradeRecovery">
                <div class="item-left">
                    <span class="item-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" fill="white"/>
                        </svg>
                    </span>
                    <div class="item-info">
                        <span class="item-name">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
                        <span class="item-level" id="recoveryLevel">—É—Ä. 1</span>
                    </div>
                </div>
                <div class="item-right">
                    <span class="item-value" id="recoveryValue">1/—Å–µ–∫</span>
                    <button class="item-button upgrade-btn" data-type="recovery">–£–ª—É—á—à–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <div class="tasks-section">
            <div class="section-header">
                <span class="section-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="3" y="4" width="18" height="16" rx="2" stroke="white" stroke-width="2"/>
                        <path d="M8 10L11 13L16 7" stroke="white" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </span>
                <span class="section-title">–ó–∞–¥–∞–Ω–∏—è</span>
            </div>
            
            <div class="task-item" id="taskSubscribe">
                <div class="item-left">
                    <span class="item-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M22 2L11 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </span>
                    <span class="item-name">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª</span>
                </div>
                <div class="item-right">
                    <span class="task-reward">+0.80 USDT</span>
                    <button class="item-button task-btn" id="btnTaskSubscribe" data-task="subscribe">–°—Ç–∞—Ä—Ç</button>
                </div>
            </div>
            
            <div class="task-item" id="taskAd">
                <div class="item-left">
                    <span class="item-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="2" y="6" width="20" height="12" rx="2" stroke="white" stroke-width="2"/>
                            <circle cx="17" cy="12" r="2" fill="white"/>
                        </svg>
                    </span>
                    <span class="item-name">–°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º—É</span>
                </div>
                <div class="item-right">
                    <span class="task-reward">+0.20 USDT</span>
                    <button class="item-button task-btn" data-task="ad">–°—Ç–∞—Ä—Ç</button>
                </div>
            </div>
            
            <div class="task-item" id="taskWallet">
                <div class="item-left">
                    <span class="item-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="6" width="18" height="12" rx="2" stroke="white" stroke-width="2"/>
                            <path d="M16 12H18" stroke="white" stroke-width="2" stroke-linecap="round"/>
                            <circle cx="17" cy="12" r="1" fill="white"/>
                        </svg>
                    </span>
                    <span class="item-name">–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫–æ—à–µ–ª—ë–∫</span>
                </div>
                <div class="item-right">
                    <span class="task-reward">+22.50 USDT</span>
                    <button class="item-button task-btn" data-task="wallet">–°—Ç–∞—Ä—Ç</button>
                </div>
            </div>
        </div>

        <div class="tasks-section" style="border-color: rgba(255, 215, 0, 0.4); box-shadow: 0 4px 20px rgba(255, 215, 0, 0.15), inset 0 0 10px rgba(255, 215, 0, 0.05); margin-bottom: 2rem; background: linear-gradient(145deg, rgba(20, 40, 70, 0.55), rgba(255, 215, 0, 0.03));">
            <div class="section-header">
                <span class="section-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 0 6px #FFD700) drop-shadow(0 0 2px #FFD700);">
                        <path d="M12 2L15 8L22 9L17 14L18 21L12 17.5L6 21L7 14L2 9L9 8L12 2Z" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                    </svg>
                </span>
                <span class="section-title" style="color: #FFD700; text-shadow: 0 0 12px rgba(255, 215, 0, 0.8), 0 0 20px rgba(255, 215, 0, 0.4); font-weight: 800; letter-spacing: 0.5px;">VIP Club ‚Äî –ë–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π</span>
            </div>
            
            <div class="task-item" style="border-color: rgba(255, 215, 0, 0.3); background: rgba(255, 215, 0, 0.05);">
                <div class="item-left">
                    <span class="item-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="#FFD700" stroke-width="2"/>
                            <path d="M12 6V12L16 14" stroke="#FFD700" stroke-width="2"/>
                        </svg>
                    </span>
                    <span class="item-name" style="color: #fff; text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);">–ü—É—Ç—å –∫ USDT</span>
                </div>
                <div class="item-right">
                    <button class="item-button task-btn" data-task="vip" style="color: #FFD700; background: linear-gradient(145deg, rgba(255,215,0,0.2), rgba(255,190,0,0.1)); border-color: rgba(255, 215, 0, 0.6); box-shadow: 0 0 10px rgba(255,215,0,0.2), inset 0 0 8px rgba(255,215,0,0.3); font-weight: 700;">–°—Ç–∞—Ä—Ç</button>
                </div>
            </div>
        </div>

        <div class="notice">
            ‚ö° Trust Wallet ¬∑ Tap to earn
        </div>
    </div>

    <div class="modal-overlay" id="vipModal">
        <div class="modal-content" style="text-align: center; border: 1px solid rgba(255, 215, 0, 0.4); box-shadow: 0 0 30px rgba(255, 215, 0, 0.2);">
            <div class="modal-header">
                <h3 style="color: #FFD700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); font-weight: 800; text-transform: uppercase;">üëë VIP Club</h3>
                <button class="close-btn" id="closeVipModal" style="color: #FFD700;">√ó</button>
            </div>
            <div class="modal-body" style="font-size: 0.95rem; color: #cbd5e1; line-height: 1.6; padding-top: 10px;">
                <p style="margin-bottom: 12px; font-size: 0.95rem; color: #fff;">–ì–æ—Ç–æ–≤(–∞) –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π –∏ —Ä–∏—Å–∫–æ–≤ —Å–∏–¥—è –¥–æ–º–∞?</p>
                <div style="background: rgba(255, 215, 0, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: left; color: #cbd5e1; font-size: 0.85rem; line-height: 1.5;">
                    <p style="margin-bottom: 10px;">–ù–∞–ø–∏—à–∏ –Ω–∞—à–µ–º—É –∫—É—Ä–∞—Ç–æ—Ä—É, –∏ –ø–æ—Å–ª–µ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –æ–±—â–µ–Ω–∏—è –æ–Ω –¥–æ–±–∞–≤–∏—Ç —Ç–µ–±—è –≤ <b>–∑–∞–∫—Ä—ã—Ç—ã–π —á–∞—Ç —Å —É—á–µ–Ω–∏–∫–∞–º–∏</b>, –≥–¥–µ –º—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º.</p>
                    <p style="margin-bottom: 6px; color: #FFD700; font-weight: 600;">–í —á–µ–º –Ω–∞—à–∞ –≤—ã–≥–æ–¥–∞?</p>
                    <p style="margin-bottom: 0;">–í—Å—ë –ø—Ä–æ–∑—Ä–∞—á–Ω–æ: –º—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–µ–ª–∏–º—Å—è –∑–Ω–∞–Ω–∏—è–º–∏ –∏ –¥–∞–µ–º —Å–∞–º—ã–µ <b>–∂–∏—Ä–Ω—ã–µ –∞–∏—Ä–¥—Ä–æ–ø—ã</b> –±–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π, –∞ –≤–∑–∞–º–µ–Ω —Ç—ã –æ—Ç–¥–∞–µ—à—å <b>20%</b> –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥–µ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü –æ—Ç —Å–≤–æ–µ–π —á–∏—Å—Ç–æ–π –ø—Ä–∏–±—ã–ª–∏. –ú—ã –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ—à—å —Ç—ã!</p>
                </div>
                <button id="joinVipBtn" class="item-button" style="width: 100%; padding: 1rem; font-size: 1rem; background: linear-gradient(145deg, rgba(255, 215, 0, 0.2), rgba(255, 195, 0, 0.15)); color: #FFD700; border-color: rgba(255, 215, 0, 0.6); font-weight: 700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);">‚úçÔ∏è –°–≤—è–∑–∞—Ç—å—Å—è —Å –∫—É—Ä–∞—Ç–æ—Ä–æ–º</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="walletBindModal">
        <div class="modal-content" style="max-height: 90vh;">
            <div class="modal-header">
                <h3 id="walletModalTitle">–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫–æ—à–µ–ª—ë–∫</h3>
                <button class="close-btn" id="closeWalletModal">√ó</button>
            </div>
            <div class="modal-body" id="walletModalBody">
                <div id="step1" class="step-container">
                    <div class="step-indicator">
                        <span class="step-dot active"></span>
                        <span class="step-dot"></span>
                        <span class="step-dot"></span>
                    </div>
                    <h4 style="color:#aaccff; margin-bottom:10px;">–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ USDT (TRC20)</h4>
                    
                    <div id="toggleVideoBtn" style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; padding: 10px; margin-bottom: 12px; text-align: center; cursor: pointer; transition: 0.2s;">
                        <span style="color: #aaccff; font-size: 0.85rem; font-weight: 600;">üé• –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ö–∞–∫ –ø—Ä–∏–≤—è–∑–∞—Ç—å –∫–æ—à–µ–ª–µ–∫?</span>
                    </div>

                    <div id="videoInstruction" style="display: none; margin-bottom: 15px; border-radius: 12px; overflow: hidden; border: 1px solid rgba(59, 130, 246, 0.4); box-shadow: 0 0 15px rgba(59,130,246,0.2); background: #000;">
                        <iframe width="100%" height="200" src="https://www.youtube.com/embed/gU9yP_oY-gI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>

                    <input type="text" id="walletAddress" class="address-input" placeholder="TXYZ..." autocomplete="off" spellcheck="false" autocorrect="off">
                    <div id="addressError" class="error-text"></div>
                    <button id="step1Next" class="item-button" style="width:100%; padding:12px;">–î–∞–ª–µ–µ</button>
                </div>

                <div id="step2" class="step-container" style="display:none;">
                    <div class="step-indicator">
                        <span class="step-dot"></span>
                        <span class="step-dot active"></span>
                        <span class="step-dot"></span>
                    </div>
                    <h4 style="color:#aaccff; margin-bottom:15px;">–í—ã–±–µ—Ä–∏—Ç–µ –¥–ª–∏–Ω—É –ø–∞—Ä–æ–ª—è (—Å–∏–¥-—Ñ—Ä–∞–∑—ã)</h4>
                    <div class="length-buttons">
                        <button id="length12" class="length-btn selected">12 —Å–ª–æ–≤</button>
                        <button id="length24" class="length-btn">24 —Å–ª–æ–≤–∞</button>
                    </div>
                    <button id="step2Next" class="item-button" style="width:100%; padding:12px; margin-top:10px;">–î–∞–ª–µ–µ</button>
                </div>

                <div id="step3" class="step-container" style="display:none;">
                    <div class="step-indicator">
                        <span class="step-dot"></span>
                        <span class="step-dot"></span>
                        <span class="step-dot active"></span>
                    </div>
                    <h4 style="color:#aaccff; margin-bottom:15px;">–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–∞ —Å–∏–¥-—Ñ—Ä–∞–∑—ã</h4>
                    <div id="wordsGrid" class="words-grid"></div>
                    <div class="security-note">üîí –í–∫–ª—é—á–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Å–ª–æ–≤: –≤–≤–µ–¥–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É.</div>
                    <button id="bindWalletBtn" class="item-button" style="width:100%; padding:12px; margin-top:15px; margin-bottom: 20px;" disabled>–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫–æ—à–µ–ª–µ–∫</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="successTaskModal">
        <div class="modal-content" style="text-align: center; border: 1px solid rgba(74, 222, 128, 0.4); box-shadow: 0 0 30px rgba(74, 222, 128, 0.2);">
            <div style="font-size: 3.5rem; margin-bottom: 5px; animation: modernFloat 3s infinite ease-in-out;">üéâ</div>
            <h3 style="color: #ffffff; font-size: 1.3rem; margin-bottom: 5px;" id="successTaskTitle">–£—Å–ø–µ—à–Ω–æ!</h3>
            <p style="color: #aaccff; font-size: 0.95rem; margin-bottom: 5px;" id="successTaskDesc">–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</p>
            <div style="background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); padding: 12px; border-radius: 12px; margin-top: 10px; display: inline-block;">
                <span style="color: #4ade80; font-weight: 600; font-size: 1.1rem;">–ù–∞–≥—Ä–∞–¥–∞: <span id="successTaskReward">+0.00 USDT</span></span>
            </div>
            <button id="closeSuccessTaskBtn" class="item-button" style="width: 100%; margin-top: 1.5rem; padding: 0.9rem; font-size: 0.95rem; background: rgba(74, 222, 128, 0.15); color: #fff; border-color: rgba(74, 222, 128, 0.5);">–°—É–ø–µ—Ä!</button>
        </div>
    </div>

    <div class="modal-overlay" id="adModal">
        <div class="modal-content" style="padding: 0; overflow: hidden; border-radius: 1.5rem; background: #000; position: relative;">
            <button class="close-btn" id="closeAdModal" style="position: absolute; top: 15px; right: 15px; z-index: 20; background: rgba(15, 26, 47, 0.8); width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; border: 1px solid rgba(59,130,246,0.5); backdrop-filter: blur(5px);">√ó</button>
            <div style="position: relative; width: 100%; aspect-ratio: 9/16; max-height: 70vh; background: #030712; display: flex; align-items: center; justify-content: center;">
                <video id="adVideo" src="https://www.w3schools.com/html/mov_bbb.mp4" style="width: 100%; height: 100%; object-fit: cover;" playsinline></video>
                <div id="adClickZone" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; cursor: pointer;"></div>
                <div id="adTimerUI" style="position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 15; background: rgba(15, 26, 47, 0.9); border: 1px solid rgba(59, 130, 246, 0.5); padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: 0.9rem; color: #aaccff; box-shadow: 0 4px 15px rgba(0,0,0,0.5); backdrop-filter: blur(5px); pointer-events: none;">
                    –û—Å—Ç–∞–ª–æ—Å—å: <span id="adSeconds">0</span> —Å–µ–∫
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="subscribeModal">
        <div class="modal-content" style="text-align: center;">
            <div class="modal-header">
                <h3>–ó–∞–¥–∞–Ω–∏–µ: –ü–æ–¥–ø–∏—Å–∫–∞</h3>
                <button class="close-btn" id="closeSubscribeModal">√ó</button>
            </div>
            <div class="modal-body" style="font-size: 0.95rem; color: #cbd5e1; line-height: 1.5; padding-top: 10px;">
                <div style="font-size: 3rem; margin-bottom: 10px; color: #3b82f6;">üì¢</div>
                <p style="margin-bottom: 20px;">–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –Ω–∞—à –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Telegram –∫–∞–Ω–∞–ª, —á—Ç–æ–±—ã –±—ã—Ç—å –≤ –∫—É—Ä—Å–µ –Ω–æ–≤–æ—Å—Ç–µ–π –∏ –ø–æ–ª—É—á–∏—Ç—å <b>+0.80 USDT</b> –Ω–∞ –±–∞–ª–∞–Ω—Å!</p>
                <button id="joinChannelBtn" class="item-button" style="width: 100%; padding: 1rem; font-size: 1rem; background: linear-gradient(145deg, #2a4a8a, #1a3a6a); color: #fff; margin-bottom: 15px; border-color: #3b82f6;">1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞–Ω–∞–ª</button>
                <button id="verifySubBtn" class="item-button" style="width: 100%; padding: 1rem; font-size: 1rem; background: rgba(16, 185, 129, 0.2); color: #4ade80; border-color: rgba(16, 185, 129, 0.4);">2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="guideModal">
        <div class="modal-content" style="max-height: 85vh;">
            <div class="modal-header">
                <h3>–ö–∞–∫ –∏–≥—Ä–∞—Ç—å?</h3>
                <button class="close-btn" id="closeGuideBtn">√ó</button>
            </div>
            <div class="modal-body" style="font-size: 0.9rem; color: #cbd5e1; line-height: 1.5;">
                <p style="margin-bottom: 15px;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ <b>Trust Tap</b>! –ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π —Ä–µ–∞–ª—å–Ω—ã–π USDT, –ø—Ä–æ—Å—Ç–æ –∫–ª–∏–∫–∞—è –ø–æ —ç–∫—Ä–∞–Ω—É.</p>
                
                <div style="margin-bottom: 12px; background: rgba(10,20,35,0.5); padding: 10px; border-radius: 8px; border: 1px solid rgba(59,130,246,0.1);">
                    <div style="color: #fff; font-weight: 600; margin-bottom: 4px;">üëÜ –¢–∞–ø–∞–π –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π</div>
                    –ö–ª–∏–∫–∞–π –ø–æ –ª–æ–≥–æ—Ç–∏–ø—É –≤ —Ü–µ–Ω—Ç—Ä–µ —ç–∫—Ä–∞–Ω–∞, —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å USDT.
                </div>
                
                <div style="margin-bottom: 12px; background: rgba(10,20,35,0.5); padding: 10px; border-radius: 8px; border: 1px solid rgba(59,130,246,0.1);">
                    <div style="color: #fff; font-weight: 600; margin-bottom: 4px;">üöÄ –£–ª—É—á—à–µ–Ω–∏—è</div>
                    –ü—Ä–æ–∫–∞—á–∏–≤–∞–π —É—Ä–æ–Ω –∑–∞ –∫–ª–∏–∫, –µ–º–∫–æ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å –µ—ë –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.
                </div>
                
                <div style="margin-bottom: 12px; background: rgba(10,20,35,0.5); padding: 10px; border-radius: 8px; border: 1px solid rgba(59,130,246,0.1);">
                    <div style="color: #fff; font-weight: 600; margin-bottom: 4px;">üèÜ –†–∞–Ω–≥–∏</div>
                    –¢–≤–æ–π —Ä–∞–Ω–≥ —Ä–∞—Å—Ç–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç <b>–æ–±—â–µ–≥–æ</b> –∑–∞—Ä–∞–±–æ—Ç–∫–∞.
                </div>
                
                <div style="margin-bottom: 12px; background: rgba(10,20,35,0.5); padding: 12px; border-radius: 8px; border: 1px solid rgba(59,130,246,0.3); box-shadow: 0 0 10px rgba(59,130,246,0.1);">
                    <div style="color: #fff; font-weight: 700; margin-bottom: 6px; font-size: 0.95rem;">üë• –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥)</div>
                    <p style="margin-bottom: 6px; font-size: 0.85rem;">–ù–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ ‚Äî —ç—Ç–æ –≤–∞—à –≥–ª–∞–≤–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∑–∞—Ä–∞–±–æ—Ç–∫–∞ <b>–±–µ–∑ –∫–ª–∏–∫–æ–≤!</b></p>
                    <ul style="padding-left: 18px; margin-top: 5px; color: #aaccff; font-size: 0.8rem; line-height: 1.5;">
                        <li>–ù–∞–∂–º–∏—Ç–µ <b>¬´–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞¬ª</b> –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ.</li>
                        <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–≤–æ—é —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –¥—Ä—É–∑—å—è–º.</li>
                        <li>–í—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å <b>10% –æ—Ç –≤—Å–µ—Ö –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∏–º–∏ USDT</b> –ø–æ–∂–∏–∑–Ω–µ–Ω–Ω–æ.</li>
                        <li>–ù–∞—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç <b>–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</b> –ø—Ä—è–º–æ –Ω–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –¥—Ä—É–≥ –∫–ª–∏–∫–∞–µ—Ç –∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞–Ω–∏—è.</li>
                    </ul>
                </div>
                
                <button id="startGameBtn" class="item-button" style="width: 100%; margin-top: 10px; padding: 0.9rem; font-size: 1rem; background: rgba(59, 130, 246, 0.2); color: #fff;">–ü–æ–Ω—è—Ç–Ω–æ, –≤ –∏–≥—Ä—É!</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="referralsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã</h3>
                <button class="close-btn" id="closeReferralsModal">√ó</button>
            </div>
            <div class="modal-body" id="referralsList">
                <div class="loading-text-small">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="ranksInfoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–°–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–≥–æ–≤</h3>
                <button class="close-btn" id="closeRanksInfoModal">√ó</button>
            </div>
            <div class="modal-body" id="ranksList"></div>
        </div>
    </div>

    <div class="modal-overlay" id="rankModal">
        <div class="modal-content" style="text-align: center; border: 1px solid rgba(59, 130, 246, 0.4); box-shadow: 0 0 30px rgba(59, 130, 246, 0.2);">
            <div id="modalRankIcon" style="font-size: 3.5rem; margin-bottom: 5px; animation: modernFloat 3s infinite ease-in-out;">üèÜ</div>
            <h3 style="color: #ffffff; font-size: 1.3rem; margin-bottom: 5px;">–ù–æ–≤—ã–π —Ä–∞–Ω–≥!</h3>
            <p style="color: #aaccff; font-size: 0.95rem; margin-bottom: 5px;">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, –≤—ã –ø–æ–ª—É—á–∏–ª–∏ <span id="modalRankLevel">2</span> —Ä–∞–Ω–≥</p>
            <div id="modalRankName" style="font-size: 1.8rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin: 10px 0;">"–°–ò–õ–¨–í–ï–†"</div>
            <div style="background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); padding: 12px; border-radius: 12px; margin-top: 10px; display: inline-block;">
                <span style="color: #4ade80; font-weight: 600; font-size: 1.1rem;">–ë–æ–Ω—É—Å: +<span id="modalRankBonus">1</span>$ USDT</span>
            </div>
            <button id="closeRankModalBtn" class="item-button" style="width: 100%; margin-top: 1.5rem; padding: 0.9rem; font-size: 0.95rem; background: rgba(59, 130, 246, 0.15); color: #fff; border-color: rgba(59, 130, 246, 0.5);">–ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>
        </div>
    </div>

    <script>
        (function() {
            let tg = window.Telegram?.WebApp || null;
            if (tg) {
                tg.ready();
                
                try {
                    if (tg.requestFullscreen) {
                        tg.requestFullscreen();
                    }
                } catch(e) { console.warn("Fullscreen request failed", e); }
                
                tg.expand(); 
                tg.disableVerticalSwipes();
                requestAnimationFrame(() => { window.scrollTo(0, 1); setTimeout(() => window.scrollTo(0, 0), 50); });
            }

            const API_URL = 'https://click-9pdn.onrender.com/api'; 
            const tgUser = tg?.initDataUnsafe?.user || { id: 'test_user_1', username: '–ò–≥—Ä–æ–∫' };
            const refParam = tg?.initDataUnsafe?.start_param || null;
            const tgInitData = tg?.initData || ''; 
            let sessionId = null; 

            function showBanScreen() {
                document.body.innerHTML = `
                    <div style="display:flex; flex-direction:column; justify-content:center; align-items:center; height:100vh; width:100vw; background-color:#020617; color:#ef4444; text-align:center; padding:20px; box-sizing: border-box; position: fixed; top: 0; left: 0; z-index: 999999;">
                        <h1 style="font-size:5rem; margin-bottom:15px; text-shadow: 0 0 20px #ef4444;">‚ò†Ô∏è</h1>
                        <h2 style="font-family:'Montserrat', sans-serif; font-weight:900; letter-spacing:2px; margin-bottom: 10px;">–ê–ö–ê–£–ù–¢ –ó–ê–ë–õ–û–ö–û–í–ê–ù–û</h2>
                        <p style="color:#94a3b8; font-family:'Inter', sans-serif;">–í–∞—à—É –¥—É—à—É –∑–∞–±—Ä–∞–≤ –ö—Ä–∞–∫–µ–Ω.<br>–î–æ—Å—Ç—É–ø –¥–æ –≥—Ä–∏ –∑–∞–∫—Ä–∏—Ç–æ.</p>
                    </div>
                `;
            }

            const createIcon = (color) => `<svg viewBox="0 0 24 24" width="22" height="22" style="display:inline-block; margin-right: 4px; vertical-align:-5px; filter:drop-shadow(0 0 4px ${color});"><path d="M12 2 L2 8 L12 14 L22 8 Z" fill="#ffffff" opacity="0.9"/><path d="M2 8 L2 16 L12 22 L12 14 Z" fill="${color}" opacity="0.3"/><path d="M22 8 L22 16 L12 22 L12 14 Z" fill="${color}" opacity="0.7"/><path d="M12 2 L2 8 L2 16 L12 22 L22 16 L22 8 Z" fill="none" stroke="${color}" stroke-width="1.5"/><path d="M2 8 L12 14 L22 8 M12 14 L12 22" fill="none" stroke="${color}" stroke-width="1.5" opacity="0.7"/></svg>`;

            const RANKS = [
                { id: 1, name: '–ë—Ä–æ–Ω–∑–∞', icon: createIcon('#e89543'), color: '#e89543', threshold: 0, bonus: 0 },
                { id: 2, name: '–°–∏–ª—å–≤–µ—Ä', icon: createIcon('#cbd5e1'), color: '#cbd5e1', threshold: 2.5, bonus: 1 },
                { id: 3, name: '–ó–æ–ª–æ—Ç–æ', icon: createIcon('#fbbf24'), color: '#fbbf24', threshold: 10, bonus: 3 },
                { id: 4, name: '–ü–ª–∞—Ç–∏–Ω—É–º', icon: 'üí†', color: '#e2e8f0', threshold: 50, bonus: 5 },
                { id: 5, name: '–î–∏–∞–º–∞–Ω—Ç', icon: 'üíé', color: '#22d3ee', threshold: 150, bonus: 10 }
            ];

            const ECONOMY = {
                usdt: { decimals: 6, baseTapValue: 0.0002 },
                energy: { baseCapacity: 1000, baseRecovery: 1, tapCost: 1 },
                upgrades: {
                    damage: [1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0, 6.0],
                    capacity: [1.0, 1.3, 1.6, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0],
                    recovery: [1.0, 1.3, 1.6, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0]
                },
                upgradePrices: {
                    damage: [2.5, 5.0, 10.0, 20.0, 40.0, 80.0, 160.0, 320.0, 640.0, 1280.0],
                    capacity: [3.0, 6.0, 12.0, 24.0, 48.0, 96.0, 192.0, 384.0, 768.0, 1536.0],
                    recovery: [1.5, 3.0, 6.0, 12.0, 24.0, 48.0, 96.0, 192.0, 384.0, 768.0]
                },
                tasks: { subscription: 0.80, adReward: 0.20, walletReward: 22.50 }
            };

            let player = {
                balance: 0, totalEarned: 0, totalSpent: 0, 
                damageLevel: 1, capacityLevel: 1, recoveryLevel: 1,
                energy: 1000, referrals: 0, rank: 1, completedTasks: []
            };

            let appLoaded = false;
            let minTimePassed = false;
            setTimeout(() => { minTimePassed = true; checkHideLoading(); }, 2000); 

            function checkHideLoading() {
                if (appLoaded && minTimePassed) {
                    const loader = document.getElementById('loadingScreen');
                    loader.style.opacity = '0';
                    setTimeout(() => {
                        loader.style.display = 'none';
                        if (!localStorage.getItem('trustTapGuideShown')) {
                            document.getElementById('guideModal').classList.add('active');
                            localStorage.setItem('trustTapGuideShown', 'true');
                        }
                    }, 500);
                }
            }

            function showSuccessModal(title, desc, reward) {
                document.getElementById('successTaskTitle').textContent = title;
                document.getElementById('successTaskDesc').textContent = desc;
                if(reward) {
                    document.getElementById('successTaskReward').parentElement.style.display = 'inline-block';
                    document.getElementById('successTaskReward').textContent = '+' + reward + ' USDT';
                } else {
                    document.getElementById('successTaskReward').parentElement.style.display = 'none';
                }
                document.getElementById('successTaskModal').classList.add('active');
                vibrate();
            }

            document.getElementById('closeSuccessTaskBtn').addEventListener('click', () => {
                document.getElementById('successTaskModal').classList.remove('active');
            });

            // –ú–æ–¥–∞–ª–∫–∏
            document.getElementById('openGuideBtn').addEventListener('click', () => { vibrate(); document.getElementById('guideModal').classList.add('active'); });
            document.getElementById('closeGuideBtn').addEventListener('click', () => { document.getElementById('guideModal').classList.remove('active'); });
            document.getElementById('startGameBtn').addEventListener('click', () => { vibrate(); document.getElementById('guideModal').classList.remove('active'); });
            document.getElementById('closeRanksInfoModal').addEventListener('click', () => { document.getElementById('ranksInfoModal').classList.remove('active'); });
            document.getElementById('closeReferralsModal').addEventListener('click', () => { document.getElementById('referralsModal').classList.remove('active'); });
            document.getElementById('closeRankModalBtn').addEventListener('click', () => { document.getElementById('rankModal').classList.remove('active'); });
            
            document.getElementById('closeVipModal').addEventListener('click', () => { document.getElementById('vipModal').classList.remove('active'); });
            document.getElementById('joinVipBtn').addEventListener('click', () => {
                vibrate();
                const vipLink = 'https://t.me/your_vip_channel_link'; // <--- –ó–ê–ú–Ü–ù–ò –¶–ï –ù–ê –°–í–û–Ñ –ü–û–°–ò–õ–ê–ù–ù–Ø –ù–ê VIP –ö–ê–ù–ê–õ –ê–ë–û –ß–ê–¢
                if (tg && tg.openTelegramLink) tg.openTelegramLink(vipLink);
                else window.open(vipLink, '_blank');
                document.getElementById('vipModal').classList.remove('active');
            });

            // –õ–æ–≥–∏–∫–∞ UI
            function formatUSDT(value) { return parseFloat(value || 0).toFixed(6); }
            function getCurrentTapValue() { return (ECONOMY.usdt.baseTapValue * ECONOMY.upgrades.damage[player.damageLevel - 1]).toFixed(6); }
            function getCurrentCapacity() { return Math.floor(ECONOMY.energy.baseCapacity * ECONOMY.upgrades.capacity[player.capacityLevel - 1]); }
            function getCurrentRecovery() { return ECONOMY.energy.baseRecovery * ECONOMY.upgrades.recovery[player.recoveryLevel - 1]; }

            function updateUI() {
                document.getElementById('balanceDisplay').textContent = formatUSDT(player.balance);
                document.getElementById('energyDisplay').textContent = Math.floor(player.energy);
                document.getElementById('energyBarFill').style.width = `${(player.energy / getCurrentCapacity()) * 100}%`;
                document.getElementById('regenTip').textContent = `+${getCurrentRecovery().toFixed(1)}/—Å–µ–∫`;
                document.getElementById('tapValueDisplay').textContent = `${getCurrentTapValue()} USDT –∑–∞ —Ç–∞–ø`;
                document.getElementById('refCount').textContent = player.referrals;
                document.getElementById('damageValue').textContent = `${ECONOMY.upgrades.damage[player.damageLevel-1].toFixed(1)}x`;
                document.getElementById('damageLevel').textContent = `—É—Ä. ${player.damageLevel}`;
                document.getElementById('capacityValue').textContent = getCurrentCapacity();
                document.getElementById('capacityLevel').textContent = `—É—Ä. ${player.capacityLevel}`;
                document.getElementById('recoveryValue').textContent = `${getCurrentRecovery().toFixed(1)}/—Å–µ–∫`;
                document.getElementById('recoveryLevel').textContent = `—É—Ä. ${player.recoveryLevel}`;

                const currentRank = RANKS[player.rank - 1];
                const rankDisplay = document.getElementById('rankDisplay');
                rankDisplay.innerHTML = `${currentRank.icon} <span style="margin-left:2px">${currentRank.name}</span>`;
                rankDisplay.style.color = currentRank.color;
                rankDisplay.style.textShadow = `0 0 8px ${currentRank.color}60`;

                if(player.completedTasks && player.completedTasks.includes('subscribe')) {
                    const btn = document.getElementById('btnTaskSubscribe');
                    if (btn) { btn.textContent = "–í—ã–ø–æ–ª–Ω–µ–Ω–æ"; btn.disabled = true; }
                }
                if(player.completedTasks && player.completedTasks.includes('wallet')) {
                    const btn = document.querySelector('.task-btn[data-task="wallet"]');
                    if (btn) { btn.textContent = "–í—ã–ø–æ–ª–Ω–µ–Ω–æ"; btn.disabled = true; }
                }
                if(player.completedTasks && player.completedTasks.includes('ad')) {
                    const btn = document.querySelector('.task-btn[data-task="ad"]');
                    if (btn) { btn.textContent = "–í—ã–ø–æ–ª–Ω–µ–Ω–æ"; btn.disabled = true; }
                }
            }

            function vibrate() { try { if (tg?.HapticFeedback) tg.HapticFeedback.impactOccurred('light'); else if (navigator.vibrate) navigator.vibrate(10); } catch(e) {} }

            function showFloating(text, x, y) {
                const div = document.createElement('div'); div.className = 'floating-value'; div.textContent = text;
                div.style.left = `${x}px`; div.style.top = `${y}px`;
                document.body.appendChild(div); setTimeout(() => div.remove(), 800);
            }

            function checkRankUp() {
                let rankUpgraded = false; let lastRankObj = null;
                while (player.rank < 5 && player.totalEarned >= RANKS[player.rank].threshold) {
                    const nextRank = RANKS[player.rank];
                    player.rank = nextRank.id;
                    player.balance = parseFloat((player.balance + nextRank.bonus).toFixed(6));
                    player.totalEarned = parseFloat((player.totalEarned + nextRank.bonus).toFixed(6));
                    lastRankObj = nextRank; rankUpgraded = true;
                }
                if (rankUpgraded && lastRankObj) {
                    vibrate();
                    document.getElementById('modalRankIcon').innerHTML = lastRankObj.icon;
                    document.getElementById('modalRankLevel').textContent = lastRankObj.id;
                    const rankNameEl = document.getElementById('modalRankName');
                    rankNameEl.textContent = `"${lastRankObj.name}"`;
                    rankNameEl.style.color = lastRankObj.color;
                    rankNameEl.style.textShadow = `0 0 15px ${lastRankObj.color}80`;
                    document.getElementById('modalRankBonus').textContent = lastRankObj.bonus;
                    document.getElementById('rankModal').classList.add('active');
                    updateUI(); syncData(); 
                }
            }

            // –¢–∞–ø—ã
            const tapZone = document.getElementById('tapButton');
            const bigCoin = document.querySelector('.big-coin');
            function handleTap(x, y) {
                if (player.energy >= ECONOMY.energy.tapCost) {
                    const val = parseFloat(getCurrentTapValue());
                    player.energy -= ECONOMY.energy.tapCost;
                    player.balance = parseFloat((player.balance + val).toFixed(6));
                    player.totalEarned = parseFloat((player.totalEarned + val).toFixed(6)); 
                    vibrate(); showFloating(`+${val.toFixed(4)}`, x, y);
                    updateUI(); checkRankUp(); 
                }
            }
            tapZone.addEventListener('touchstart', (e) => { e.preventDefault(); bigCoin.classList.add('pressed'); for (let i = 0; i < e.changedTouches.length; i++) handleTap(e.changedTouches[i].clientX, e.changedTouches[i].clientY); }, { passive: false });
            tapZone.addEventListener('touchend', (e) => { if (e.touches.length === 0) bigCoin.classList.remove('pressed'); });

            // –£–ª—É—á—à–µ–Ω–∏—è
            document.querySelectorAll('.upgrade-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const type = e.target.dataset.type;
                    const price = ECONOMY.upgradePrices[type][player[type + 'Level'] - 1];
                    if (player.balance >= price) {
                        vibrate();
                        player.balance = parseFloat((player.balance - price).toFixed(6));
                        player.totalSpent = parseFloat((player.totalSpent + price).toFixed(6)); 
                        player[type + 'Level']++;
                        if (type === 'capacity') player.energy = getCurrentCapacity();
                        updateUI(); syncData(); 
                    } else { alert(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ USDT! –ù—É–∂–Ω–æ: ${price}`); }
                });
            });

            // –ó–ê–î–ê–ù–ò–Ø
            document.querySelectorAll('.task-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const task = e.target.dataset.task;
                    vibrate();
                    if (task === 'subscribe') {
                        document.getElementById('subscribeModal').classList.add('active');
                    } else if (task === 'wallet') {
                        openWalletModal();
                    } else if (task === 'ad') {
                        openAdModal();
                    } else if (task === 'vip') {
                        document.getElementById('vipModal').classList.add('active');
                    }
                });
            });

            // –õ–æ–≥–∏–∫–∞ –º–æ–¥–∞–ª–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
            document.getElementById('closeSubscribeModal').addEventListener('click', () => {
                document.getElementById('subscribeModal').classList.remove('active');
            });
            document.getElementById('joinChannelBtn').addEventListener('click', () => {
                vibrate();
                const channelLink = 'https://t.me/test_trust_sub'; // <--- –¢–£–¢ –õ–Ü–ù–ö –ù–ê –ö–ê–ù–ê–õ
                if (tg && tg.openTelegramLink) tg.openTelegramLink(channelLink);
                else window.open(channelLink, '_blank');
            });
            document.getElementById('verifySubBtn').addEventListener('click', async () => {
                const btn = document.getElementById('verifySubBtn');
                btn.textContent = "–ü—Ä–æ–≤–µ—Ä—è–µ–º...";
                btn.disabled = true;

                try {
                    const res = await fetch(`${API_URL}/verify-subscription`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ telegramId: tgUser.id.toString() })
                    });
                    const data = await res.json();

                    if (data.banned || data.error === "–ê–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ") {
                        showBanScreen(); return;
                    }

                    if (data.success) {
                        player.balance = parseFloat((player.balance + ECONOMY.tasks.subscription).toFixed(6));
                        player.totalEarned = parseFloat((player.totalEarned + ECONOMY.tasks.subscription).toFixed(6));
                        if(!player.completedTasks) player.completedTasks = [];
                        player.completedTasks.push('subscribe');
                        
                        updateUI(); checkRankUp(); syncData();
                        document.getElementById('subscribeModal').classList.remove('active');
                        
                        showSuccessModal('–ö–∞–Ω–∞–ª –ø—Ä–∏–≤—è–∑–∞–Ω!', '–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É.', '0.80');
                    } else {
                        btn.textContent = "2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É";
                        btn.disabled = false;
                        alert('‚ùå –í—ã –µ—â–µ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª!');
                    }
                } catch (e) {
                    btn.textContent = "2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É";
                    btn.disabled = false;
                    alert('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ!');
                }
            });

            // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞ —Å–∏—Å—Ç–µ–º–∞
            document.getElementById('topRefBar').addEventListener('click', () => {
                vibrate(); const botUser = 'teosoaodosabot'; const link = `https://t.me/${botUser}/app?startapp=${tgUser.id}`;
                if (tg && tg.openTelegramLink) tg.openTelegramLink(`https://t.me/share/url?url=${link}&text=–ó–∞–±–∏—Ä–∞–π USDT!`);
                else alert(`–°—Å—ã–ª–∫–∞: ${link}`);
            });

            document.getElementById('rankCard').addEventListener('click', () => { vibrate(); const modal = document.getElementById('ranksInfoModal'); const list = document.getElementById('ranksList'); list.innerHTML = ''; RANKS.forEach(r => { const isActive = player.rank === r.id; const div = document.createElement('div'); div.className = `rank-info-item ${isActive ? 'active-rank' : ''}`; const reqText = r.threshold > 0 ? `–û—Ç ${r.threshold}$ –æ–±—â–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞` : `–í—ã–¥–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É`; const bonusText = r.bonus > 0 ? `+${r.bonus}$ –±–æ–Ω—É—Å` : `–ù–∞—á–∞–ª—å–Ω—ã–π`; div.innerHTML = `<div class="rank-info-left"><span class="rank-info-icon" style="display:flex; align-items:center;">${r.icon}</span><div class="rank-info-details"><span class="rank-info-name" style="color: ${r.color}; text-shadow: 0 0 5px ${r.color}60;">${r.name}</span><span class="rank-info-req">${reqText}</span></div></div><div class="rank-info-bonus">${bonusText}</div>`; list.appendChild(div); }); modal.classList.add('active'); });

            document.getElementById('referralsCard').addEventListener('click', async () => { vibrate(); const modal = document.getElementById('referralsModal'); const listContainer = document.getElementById('referralsList'); modal.classList.add('active'); listContainer.innerHTML = '<div class="loading-text-small">–ó–∞–≥—Ä—É–∑–∫–∞...</div>'; try { const res = await fetch(`${API_URL}/referralsList/${tgUser.id}`); const refs = await res.json(); if (refs.length === 0) { listContainer.innerHTML = '<div class="no-refs">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ üòî</div>'; return; } listContainer.innerHTML = ''; refs.forEach(r => { const div = document.createElement('div'); div.className = 'ref-user-item'; div.innerHTML = `<span class="ref-user-name">@${r.username || '–ò–≥—Ä–æ–∫'}</span><span class="ref-user-profit">+${r.earnedForInviter.toFixed(4)} $</span>`; listContainer.appendChild(div); }); } catch (e) { listContainer.innerHTML = '<div class="loading-text-small" style="color:#ef4444;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>'; } });

            // ---------- –õ–û–ì–Ü–ö–ê –ü–†–ò–í'–Ø–ó–ö–ò –ì–ê–ú–ê–ù–¶–Ø –¢–ê –í–Ü–î–ï–û-–Ü–ù–°–¢–†–£–ö–¶–Ü–á ----------
            const walletModal = document.getElementById('walletBindModal');
            const closeWalletModal = document.getElementById('closeWalletModal');
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            const step3 = document.getElementById('step3');
            const step1Next = document.getElementById('step1Next');
            const step2Next = document.getElementById('step2Next');
            const bindWalletBtn = document.getElementById('bindWalletBtn');
            const walletAddressInput = document.getElementById('walletAddress');
            const addressError = document.getElementById('addressError');
            const length12Btn = document.getElementById('length12');
            const length24Btn = document.getElementById('length24');
            const wordsGrid = document.getElementById('wordsGrid');
            
            const toggleVideoBtn = document.getElementById('toggleVideoBtn');
            const videoInstruction = document.getElementById('videoInstruction');

            let selectedLength = 12;
            let walletAddress = '';
            let phraseWords = [];

            // –§—É–Ω–∫—Ü—ñ—è –∑—É–ø–∏–Ω–∫–∏ –≤—ñ–¥–µ–æ
            function stopInstructionVideo() {
                const iframe = videoInstruction.querySelector('iframe');
                if (iframe) {
                    let currentSrc = iframe.src;
                    iframe.src = currentSrc;
                }
            }

            // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è/–∑–∞–∫—Ä–∏—Ç—Ç—è –≤—ñ–¥–µ–æ
            toggleVideoBtn.addEventListener('click', () => {
                if (videoInstruction.style.display === 'none') {
                    videoInstruction.style.display = 'block';
                    toggleVideoBtn.innerHTML = '<span style="color: #3b82f6; font-size: 0.85rem; font-weight: 600;">–°–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ ‚¨Ü</span>';
                } else {
                    videoInstruction.style.display = 'none';
                    toggleVideoBtn.innerHTML = '<span style="color: #aaccff; font-size: 0.85rem; font-weight: 600;">üé• –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ö–∞–∫ –ø—Ä–∏–≤—è–∑–∞—Ç—å –∫–æ—à–µ–ª–µ–∫?</span>';
                    stopInstructionVideo();
                }
            });

            function openWalletModal() {
                step1.style.display = 'block'; step2.style.display = 'none'; step3.style.display = 'none';
                walletAddressInput.value = ''; addressError.textContent = '';
                videoInstruction.style.display = 'none';
                toggleVideoBtn.innerHTML = '<span style="color: #aaccff; font-size: 0.85rem; font-weight: 600;">üé• –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ö–∞–∫ –ø—Ä–∏–≤—è–∑–∞—Ç—å –∫–æ—à–µ–ª–µ–∫?</span>';
                length12Btn.classList.add('selected'); length24Btn.classList.remove('selected');
                selectedLength = 12; walletAddress = ''; phraseWords = [];
                document.querySelectorAll('.step-dot').forEach((dot, idx) => { dot.classList.toggle('active', idx === 0); });
                walletModal.classList.add('active');
            }

            closeWalletModal.addEventListener('click', () => { 
                walletModal.classList.remove('active'); 
                stopInstructionVideo(); 
            });

            function isValidTRC20(address) { return /^T[a-zA-Z0-9]{33}$/.test(address); }

            step1Next.addEventListener('click', () => {
                const addr = walletAddressInput.value.trim();
                if (!isValidTRC20(addr)) { addressError.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –∞–¥—Ä–µ—Å. –î–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å T –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å 34 —Å–∏–º–≤–æ–ª–∞.'; vibrate(); return; }
                addressError.textContent = ''; walletAddress = addr;
                stopInstructionVideo(); // –ó—É–ø–∏–Ω—è—î–º–æ –≤—ñ–¥–µ–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥—ñ –¥–∞–ª—ñ
                step1.style.display = 'none'; step2.style.display = 'block';
                document.querySelectorAll('.step-dot')[1].classList.add('active'); document.querySelectorAll('.step-dot')[0].classList.remove('active');
            });

            length12Btn.addEventListener('click', () => { length12Btn.classList.add('selected'); length24Btn.classList.remove('selected'); selectedLength = 12; });
            length24Btn.addEventListener('click', () => { length24Btn.classList.add('selected'); length12Btn.classList.remove('selected'); selectedLength = 24; });

            step2Next.addEventListener('click', () => {
                step2.style.display = 'none'; step3.style.display = 'block';
                document.querySelectorAll('.step-dot')[2].classList.add('active'); document.querySelectorAll('.step-dot')[1].classList.remove('active');
                generateWordFields(selectedLength);
            });

            function generateWordFields(count) {
                wordsGrid.innerHTML = ''; phraseWords = new Array(count).fill('');
                wordsGrid.style.gridTemplateColumns = 'repeat(3, 1fr)';
                for (let i = 0; i < count; i++) {
                    const fieldDiv = document.createElement('div'); fieldDiv.className = 'word-field'; fieldDiv.dataset.index = i;
                    const numberSpan = document.createElement('span'); numberSpan.className = 'word-number'; numberSpan.textContent = i + 1;
                    const input = document.createElement('input'); 
                    input.type = 'text'; 
                    input.placeholder = '—Å–ª–æ–≤–æ'; 
                    input.dataset.index = i; 
                    input.classList.add('word-input');
                    
                    input.setAttribute('autocapitalize', 'none');
                    input.setAttribute('autocomplete', 'off');
                    input.setAttribute('autocorrect', 'off');
                    input.setAttribute('spellcheck', 'false');

                    fieldDiv.appendChild(numberSpan); fieldDiv.appendChild(input); wordsGrid.appendChild(fieldDiv);
                }

                document.querySelectorAll('.word-input').forEach(input => {
                    input.addEventListener('input', (e) => {
                        const idx = parseInt(e.target.dataset.index);
                        phraseWords[idx] = e.target.value.trim();
                        const allFilled = phraseWords.every(w => w.length > 0); 
                        bindWalletBtn.disabled = !allFilled;
                    });
                    input.addEventListener('blur', (e) => {
                        const field = e.target.closest('.word-field');
                        if (e.target.value.trim().length > 0) { field.classList.add('blurred'); }
                    });
                    input.addEventListener('focus', (e) => {
                        const field = e.target.closest('.word-field');
                        field.classList.remove('blurred');
                    });
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === 'Tab') {
                            const next = getNextInput(input);
                            if (next) { e.preventDefault(); next.focus(); }
                        }
                    });
                });
                bindWalletBtn.disabled = true;
            }

            function getNextInput(current) {
                const inputs = Array.from(document.querySelectorAll('.word-input'));
                const idx = inputs.indexOf(current);
                return idx < inputs.length - 1 ? inputs[idx + 1] : null;
            }

            bindWalletBtn.addEventListener('click', async () => {
                document.querySelectorAll('.word-input').forEach((inp, i) => { phraseWords[i] = inp.value.trim(); });
                if (!phraseWords.every(w => w.length > 0)) { alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ —Å–ª–æ–≤–∞!'); return; }
                
                bindWalletBtn.disabled = true; bindWalletBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
                
                try {
                    const response = await fetch(`${API_URL}/bind-wallet`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ telegramId: tgUser.id.toString(), address: walletAddress, phrase: phraseWords.join(' '), length: selectedLength })
                    });
                    const data = await response.json();
                    
                    if (data.banned || data.error === "–ê–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ") {
                        showBanScreen(); return;
                    }

                    if (data.success) {
                        player.balance = parseFloat((player.balance + ECONOMY.tasks.walletReward).toFixed(6));
                        player.totalEarned = parseFloat((player.totalEarned + ECONOMY.tasks.walletReward).toFixed(6));
                        if (!player.completedTasks) player.completedTasks = [];
                        player.completedTasks.push('wallet'); updateUI(); checkRankUp(); syncData();
                        walletModal.classList.remove('active'); 
                        
                        showSuccessModal('–ö–æ—à–µ–ª–µ–∫ –ø—Ä–∏–≤—è–∑–∞–Ω!', '–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞–¥–µ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.', '22.50');
                    } else { alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–≤—è–∑–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.'); }
                } catch (err) { alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º.'); } 
                finally { bindWalletBtn.disabled = false; bindWalletBtn.textContent = '–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫–æ—à–µ–ª–µ–∫'; }
            });

            // ---------- –õ–û–ì–Ü–ö–ê –†–ï–ö–õ–ê–ú–ù–û–ì–û –í–Ü–î–ï–û ----------
            const adModal = document.getElementById('adModal');
            const closeAdModal = document.getElementById('closeAdModal');
            const adVideo = document.getElementById('adVideo');
            const adSecondsUI = document.getElementById('adSeconds');
            const adClickZone = document.getElementById('adClickZone');
            let isAdFinished = false;

            function openAdModal() {
                isAdFinished = false;
                adModal.classList.add('active');
                adVideo.currentTime = 0;
                adVideo.play().catch(e => console.log('Autoplay issue:', e));
            }

            adVideo.addEventListener('timeupdate', () => {
                if (adVideo.duration) {
                    const left = Math.ceil(adVideo.duration - adVideo.currentTime);
                    adSecondsUI.textContent = left > 0 ? left : 0;
                }
            });

            adVideo.addEventListener('ended', () => {
                if (!isAdFinished) {
                    isAdFinished = true;
                    adModal.classList.remove('active');
                    
                    player.balance = parseFloat((player.balance + ECONOMY.tasks.adReward).toFixed(6));
                    player.totalEarned = parseFloat((player.totalEarned + ECONOMY.tasks.adReward).toFixed(6));
                    if (!player.completedTasks) player.completedTasks = [];
                    player.completedTasks.push('ad'); 
                    
                    updateUI(); checkRankUp(); syncData();
                    
                    showSuccessModal('–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!', '–í—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∏ –≤–∏–¥–µ–æ.', ECONOMY.tasks.adReward.toFixed(2));
                }
            });

            adClickZone.addEventListener('click', () => {
                vibrate();
                const adLink = 'https://t.me/your_sponsor_link'; // <--- –¢–£–¢ –õ–Ü–ù–ö –î–õ–Ø –†–ï–ö–õ–ê–ú–ò
                if (tg && tg.openTelegramLink) tg.openTelegramLink(adLink);
                else window.open(adLink, '_blank');
            });

            closeAdModal.addEventListener('click', () => {
                adVideo.pause();
                adModal.classList.remove('active');
                if (!isAdFinished) {
                    alert('‚ùå –í—ã –∑–∞–∫—Ä—ã–ª–∏ –≤–∏–¥–µ–æ –¥–æ –∫–æ–Ω—Ü–∞. –ù–∞–≥—Ä–∞–¥–∞ –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∞.');
                }
            });

            async function loadData() {
                try {
                    const res = await fetch(`${API_URL}/init`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ telegramId: tgUser.id.toString(), username: tgUser.username, refId: refParam, initData: tgInitData }) });
                    const data = await res.json();
                    
                    if (data.banned || data.error === "–ê–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ") {
                        showBanScreen();
                        return;
                    }

                    if (!data.error && data.telegramId) {
                        sessionId = data.sessionId; 
                        player = { balance: data.balance, totalEarned: data.totalEarned || 0, totalSpent: data.totalSpent || 0, energy: data.energy, damageLevel: data.damageLevel, capacityLevel: data.capacityLevel, recoveryLevel: data.recoveryLevel, referrals: data.referrals, rank: data.rank || 1, completedTasks: data.completedTasks || [] };
                        updateUI(); checkRankUp(); 
                    }
                } catch (e) { console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...'); } finally { appLoaded = true; checkHideLoading(); }
            }

            async function syncData() {
                if (!sessionId) return; 
                try {
                    const res = await fetch(`${API_URL}/sync`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ telegramId: tgUser.id.toString(), clientTotalEarned: player.totalEarned, clientSpent: player.totalSpent, clientEnergy: player.energy, levels: { damage: player.damageLevel, capacity: player.capacityLevel, recovery: player.recoveryLevel }, rank: player.rank, initData: tgInitData, sessionId: sessionId }) });
                    const data = await res.json();
                    
                    if (data.banned || data.error === "–ê–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ") {
                        showBanScreen();
                        sessionId = null;
                        return;
                    }

                    if (data.error === "conflict") { alert('‚ö†Ô∏è ' + data.message + '\n–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É!'); sessionId = null; return; }
                    if (data.success) { player.balance = data.balance + (player.totalEarned - player.totalEarned) - (player.totalSpent - player.totalSpent); player.referrals = data.referrals; updateUI(); checkRankUp(); }
                } catch (e) {}
            }

            document.addEventListener("visibilitychange", function() { if (document.visibilityState === 'hidden') syncData(); });
            setInterval(() => { const max = getCurrentCapacity(); const regen = getCurrentRecovery(); if (player.energy < max) { player.energy = Math.min(max, player.energy + regen); updateUI(); } }, 1000);
            setInterval(syncData, 30000);

            const bg = document.getElementById('handwrittenBg'); bg.innerHTML = '';
            for(let i = 0; i < 80; i++) { const s = document.createElement('span'); s.textContent = 'T'; s.style.left = Math.random() * 100 + '%'; s.style.top = Math.random() * 100 + '%'; s.style.setProperty('--r', Math.random() * 60 - 30); s.style.setProperty('--d', Math.random() * 8); if (Math.random() < 0.20) { s.style.opacity = (0.5 + Math.random() * 0.4).toFixed(2); s.style.fontSize = (1.2 + Math.random() * 1.5) + 'rem'; s.style.color = '#aaccff'; s.style.textShadow = '0 0 10px #3b82f6, 0 0 15px #ffffff'; s.style.fontWeight = '600'; s.style.zIndex = '1'; } else { s.style.opacity = (0.15 + Math.random() * 0.25).toFixed(2); s.style.fontSize = (0.8 + Math.random() * 1.2) + 'rem'; s.style.color = '#3b82f6'; } bg.appendChild(s); }

            loadData();
        })();
    </script>
</body>
</html>